<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, viewport-fit=cover, interactive-widget=resizes-content">
    <title>7Chat - Versão Final Otimizada</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1f2937"/>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta name="description" content="Um aplicativo de chat em tempo real.">
    <link rel="apple-touch-icon" href="https://placehold.co/192x192/4f46e5/ffffff?text=7C">
    
    <!-- Favicon inline -->
    <link rel="icon" href="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3e%3ctext y='24' font-size='24' fill='%234f46e5'%3e7%3c/text%3e%3c/svg%3e" type="image/svg+xml" />
    
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'pulse': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'spin': 'spin 1s linear infinite',
                        'ping': 'ping 1s cubic-bezier(0, 0, 0.2, 1) infinite',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
      <style>
    html, body {
        height: 100vh;
        overflow: auto;
        font-family: 'Inter', sans-serif;
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%) !important;
    }
    
    .hidden {
        display: none !important;
    }
    
    /* Estilos básicos para o app */
    .modal { animation: fadeIn .3s ease-out; }
    .modal-content { animation: slideUp .3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    /* Responsividade mobile com zoom 75% */
    @media (max-width: 768px) {
        html {
            font-size: 16px; /* Base para zoom 75% */
        }
        
        body {
            overflow-x: hidden;
            font-size: 14px; /* Tamanho otimizado */
        }
        
        #app-container {
            height: 100vh;
            overflow: hidden;
        }
        
        /* Botões maiores para mobile */
        .mobile-btn {
            min-height: 48px !important;
            font-size: 16px !important;
            padding: 12px 16px !important;
        }
        
        /* Modais em tela cheia com safe area */
        .modal {
            padding: 0 !important;
        }
        
        .modal-content {
            margin: 0 !important;
            width: 100% !important;
            max-width: 100% !important;
            height: 100vh !important;
            border-radius: 0 !important;
        }
        
        /* Headers dos modais com safe area */
        .modal-header {
            min-height: calc(60px + env(safe-area-inset-top, 44px)) !important;
            padding: max(20px, env(safe-area-inset-top, 44px)) 20px 16px 20px !important;
            position: relative !important;
            z-index: 10 !important;
        }
        
        /* Inputs maiores */
        input, button {
            font-size: 16px !important; /* Evita zoom automático no iOS */
        }
        
        /* Navegação inferior otimizada */
        #bottom-nav {
            height: 70px;
            padding: 8px 0;
            padding-bottom: max(8px, env(safe-area-inset-bottom, 0px)) !important;
        }
        
        #bottom-nav .flex-col {
            padding: 8px 12px;
        }
    }

    /* Estilos dos modais em tela cheia com safe area */
    #profile-modal, #edit-name-modal, #edit-status-modal, #settings-modal, #user-profile-detail-modal, #name-effects-modal, #name-banners-modal {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: 100% !important;
        height: 100vh !important;
        background: #111827 !important;
        border-radius: 0 !important;
        margin: 0 !important;
        z-index: 9999 !important;
    }

    /* Header dos modais com safe area específica para iOS */
    .modal-header {
        background: #1f2937 !important;
        border-bottom: 1px solid #374151 !important;
        padding-top: max(20px, env(safe-area-inset-top, 44px)) !important;
        min-height: calc(60px + env(safe-area-inset-top, 44px)) !important;
        display: flex !important;
        align-items: center !important;
        position: relative !important;
        z-index: 10 !important;
    }

    /* Botões do header visíveis */
    .modal-header button {
        z-index: 11 !important;
        position: relative !important;
        min-height: 44px !important;
        min-width: 44px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }

    /* Estilo específico para tela de perfil detalhado */
    .profile-detail-section {
        border-bottom: 1px solid #374151;
        padding: 16px 20px;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .profile-detail-section:hover {
        background-color: rgba(55, 65, 81, 0.3);
    }

    .profile-detail-section:last-child {
        border-bottom: none;
    }

    .profile-detail-label {
        color: #9CA3AF;
        font-size: 14px;
        margin-bottom: 4px; 
    }

    .profile-detail-value {
        color: #FFFFFF;
        font-size: 16px;
    }

    .profile-detail-arrow {
        color: #6B7280;
    }

    /* Garantir que o conteúdo dos modais não seja cortado */
    .modal-content > div:not(.modal-header) {
        padding-top: 20px;
    }

    /* Força visibilidade dos botões */
    #close-settings-btn,
    #close-profile-btn,
    #cancel-edit-name-btn,
    #back-from-profile-detail-btn {
        opacity: 1 !important;
        visibility: visible !important;
        pointer-events: auto !important;
        color: #9CA3AF !important;
        font-size: 24px !important;
        line-height: 1 !important;
    }    #close-settings-btn:hover,
    #close-profile-btn:hover,
    #cancel-edit-name-btn:hover,
    #back-from-profile-detail-btn:hover {
        color: #D1D5DB !important;
    }

/* Correção específica para safe area dos modais de edição */
#edit-name-modal .modal-header,
#edit-status-modal .modal-header {
    padding-top: max(16px, env(safe-area-inset-top, 0px)) !important;
    padding-bottom: 16px !important;
    min-height: calc(52px + env(safe-area-inset-top, 0px)) !important;
}

/* Mobile específico */
@media (max-width: 768px) {
    #edit-name-modal .modal-header,
    #edit-status-modal .modal-header {
        padding-top: max(20px, env(safe-area-inset-top, 20px)) !important;
        min-height: calc(60px + env(safe-area-inset-top, 20px)) !important;
    }
}

/* Efeitos especiais para nomes - MODERNOS E BONITOS */
.name-effect-rainbow {
    background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7, #dda0dd, #ff9ff3);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: rainbowMove 4s ease-in-out infinite;
    font-weight: 600;
}

.name-effect-gold {
    background: linear-gradient(45deg, #ffd700, #ffed4e, #ffd700, #ffb347);
    background-size: 200% 200%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
    animation: goldShine 3s ease-in-out infinite;
    font-weight: 700;
}

.name-effect-neon {
    color: #00ffff;
    text-shadow: 
        0 0 5px #00ffff,
        0 0 10px #00ffff,
        0 0 15px #00ffff,
        0 0 20px #00ffff;
    animation: neonGlow 2s ease-in-out infinite alternate;
    font-weight: 600;
}

.name-effect-holographic {
    background: linear-gradient(45deg, #ff0080, #0080ff, #80ff00, #ff8000, #8000ff);
    background-size: 400% 400%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: holographicShift 5s ease-in-out infinite;
    font-weight: 700;
    filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3));
}

.name-effect-sunset {
    background: linear-gradient(45deg, #ff9a56, #ff6b9d, #c44569, #f8b500);
    background-size: 250% 250%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: sunsetFlow 4s ease-in-out infinite;
    font-weight: 600;
}

.name-effect-crystal {
    background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c, #4facfe, #00f2fe);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: crystalShine 4s ease-in-out infinite;
    font-weight: 700;
    filter: drop-shadow(0 0 8px rgba(102, 126, 234, 0.4));
}

.name-effect-fire {
    background: linear-gradient(45deg, #ff4757, #ff3838, #ff6348, #ffa502, #ff7675);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: fireFlicker 2s ease-in-out infinite;
    font-weight: 700;
    text-shadow: 0 0 15px rgba(255, 71, 87, 0.7);
}

.name-effect-ocean {
    background: linear-gradient(45deg, #00c9ff, #92fe9d, #00b4db, #0083b0, #74b9ff);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: oceanWave 5s ease-in-out infinite;
    font-weight: 600;
    filter: drop-shadow(0 0 12px rgba(0, 201, 255, 0.4));
}

/* Animações dos efeitos */
@keyframes rainbowMove {
    0%, 100% { background-position: 0% 50%; }
    25% { background-position: 100% 50%; }
    50% { background-position: 50% 100%; }
    75% { background-position: 0% 100%; }
}

@keyframes goldShine {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

@keyframes neonGlow {
    from { 
        text-shadow: 
            0 0 5px #00ffff,
            0 0 10px #00ffff,
            0 0 15px #00ffff,
            0 0 20px #00ffff;
    }
    to { 
        text-shadow: 
            0 0 10px #00ffff,
            0 0 20px #00ffff,
            0 0 30px #00ffff,
            0 0 40px #00ffff;
    }
}

@keyframes holographicShift {
    0% { background-position: 0% 50%; }
    20% { background-position: 100% 50%; }
    40% { background-position: 100% 0%; }
    60% { background-position: 0% 0%; }
    80% { background-position: 50% 100%; }
    100% { background-position: 0% 50%; }
}

@keyframes sunsetFlow {
    0%, 100% { background-position: 0% 50%; }
    33% { background-position: 100% 0%; }
    66% { background-position: 0% 100%; }
}

@keyframes crystalShine {
    0%, 100% { background-position: 0% 50%; }
    25% { background-position: 50% 0%; }
    50% { background-position: 100% 50%; }
    75% { background-position: 50% 100%; }
}

@keyframes fireFlicker {
    0%, 100% { 
        background-position: 0% 50%;
        filter: brightness(1) saturate(1.2);
    }
    25% { 
        background-position: 100% 30%;
        filter: brightness(1.1) saturate(1.4);
    }
    50% { 
        background-position: 80% 70%;
        filter: brightness(0.9) saturate(1.1);
    }
    75% { 
        background-position: 20% 20%;
        filter: brightness(1.05) saturate(1.3);
    }
}

@keyframes oceanWave {
    0%, 100% { background-position: 0% 50%; }
    20% { background-position: 80% 20%; }
    40% { background-position: 100% 80%; }
    60% { background-position: 20% 100%; }
    80% { background-position: 0% 30%; }
}

/* Radio button selecionado */
.effect-radio.selected {
    background-color: #3b82f6;
    border-color: #3b82f6;
}

.effect-radio.selected::after {
    content: '';
    display: block;
    width: 6px;
    height: 6px;
    background-color: white;
    border-radius: 50%;
    margin: 1px;
}

/* Incluir modal de efeitos na lista de modais em tela cheia */
#name-effects-modal {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;    height: 100vh !important;
    background: #111827 !important;
    border-radius: 0 !important;
    margin: 0 !important;
    z-index: 9999 !important;
}

/* Banner decorativos para nomes - APENAS EM SALAS */
.name-banner-heart-pink {
    background: linear-gradient(45deg, #ff6b9d, #f093fb, #ff85c2);
    background-size: 200% 200%;
    animation: heartBannerMove 4s ease-in-out infinite;
    position: relative;
    padding: 8px 16px;
    border-radius: 20px;
    margin: 4px 0;
    box-shadow: 0 2px 10px rgba(255, 107, 157, 0.4);
}

.name-banner-heart-pink::before {
    content: '❤️ ✨ 💕 ⭐ ❤️ ✨ 💕 ⭐';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    font-size: 12px;
    opacity: 0.6;
    animation: sparkleFloat 6s ease-in-out infinite;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: space-around;
    pointer-events: none;
}

.name-banner-stars-gold {
    background: linear-gradient(45deg, #ffd700, #ffed4e, #ffb347);
    background-size: 200% 200%;
    animation: goldBannerShine 3s ease-in-out infinite;
    position: relative;
    padding: 8px 16px;
    border-radius: 20px;
    margin: 4px 0;
    box-shadow: 0 2px 10px rgba(255, 215, 0, 0.4);
}

.name-banner-stars-gold::before {
    content: '⭐ ✨ 🌟 ⭐ ✨ 🌟 ⭐ ✨';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    font-size: 12px;
    opacity: 0.7;
    animation: starsTwinkle 4s ease-in-out infinite;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: space-around;
    pointer-events: none;
}

.name-banner-nature-green {
    background: linear-gradient(45deg, #4ade80, #22c55e, #16a34a);
    background-size: 200% 200%;
    animation: natureBannerFlow 5s ease-in-out infinite;
    position: relative;
    padding: 8px 16px;
    border-radius: 20px;
    margin: 4px 0;
    box-shadow: 0 2px 10px rgba(34, 197, 94, 0.4);
}

.name-banner-nature-green::before {
    content: '🌿 🍃 🌱 🌿 🍃 🌱 🌿 🍃';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    font-size: 12px;
    opacity: 0.6;
    animation: leavesSwing 6s ease-in-out infinite;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: space-around;
    pointer-events: none;
}

.name-banner-tech-blue {
    background: linear-gradient(45deg, #3b82f6, #1d4ed8, #1e40af);
    background-size: 200% 200%;
    animation: techBannerPulse 3s ease-in-out infinite;
    position: relative;
    padding: 8px 16px;
    border-radius: 20px;
    margin: 4px 0;
    box-shadow: 0 2px 10px rgba(59, 130, 246, 0.4);
}

.name-banner-tech-blue::before {
    content: '💎 ⚡ 🔷 💎 ⚡ 🔷 💎 ⚡';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    font-size: 12px;
    opacity: 0.7;
    animation: techGlow 4s ease-in-out infinite;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: space-around;
    pointer-events: none;
}

.name-banner-romantic-purple {
    background: linear-gradient(45deg, #a855f7, #9333ea, #7c3aed);
    background-size: 200% 200%;
    animation: romanticBannerFlow 4s ease-in-out infinite;
    position: relative;
    padding: 8px 16px;
    border-radius: 20px;
    margin: 4px 0;
    box-shadow: 0 2px 10px rgba(168, 85, 247, 0.4);
}

.name-banner-romantic-purple::before {
    content: '🌸 💜 🌺 🌸 💜 🌺 🌸 💜';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    font-size: 12px;
    opacity: 0.6;
    animation: flowersBloom 5s ease-in-out infinite;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: space-around;
    pointer-events: none;
}

.name-banner-galaxy-space {
    background: linear-gradient(45deg, #4c1d95, #5b21b6, #6b21a8, #7c2d92);
    background-size: 300% 300%;
    animation: galaxyBannerMove 6s ease-in-out infinite;
    position: relative;
    padding: 8px 16px;
    border-radius: 20px;
    margin: 4px 0;
    box-shadow: 0 2px 10px rgba(76, 29, 149, 0.4);
}

.name-banner-galaxy-space::before {
    content: '🌌 🚀 ⭐ 🪐 🌌 🚀 ⭐ 🪐';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    font-size: 12px;
    opacity: 0.7;
    animation: spaceFloat 8s ease-in-out infinite;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: space-around;
    pointer-events: none;
}

/* O nome fica por cima do banner */
.name-banner-heart-pink .user-name,
.name-banner-stars-gold .user-name,
.name-banner-nature-green .user-name,
.name-banner-tech-blue .user-name,
.name-banner-romantic-purple .user-name,
.name-banner-galaxy-space .user-name {
    position: relative;
    z-index: 2;
    font-weight: bold;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
    color: white;
}

/* Animações dos banners */
@keyframes heartBannerMove {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

@keyframes sparkleFloat {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-2px); }
}

@keyframes goldBannerShine {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

@keyframes starsTwinkle {
    0%, 100% { opacity: 0.7; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.1); }
}

@keyframes natureBannerFlow {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

@keyframes leavesSwing {
    0%, 100% { transform: rotate(-1deg); }
    50% { transform: rotate(1deg); }
}

@keyframes techBannerPulse {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

@keyframes techGlow {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 1; }
}

@keyframes romanticBannerFlow {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

@keyframes flowersBloom {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

@keyframes galaxyBannerMove {
    0%, 100% { background-position: 0% 50%; }
    33% { background-position: 100% 0%; }
    66% { background-position: 0% 100%; }
}

@keyframes spaceFloat {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-3px) rotate(2deg); }
}

/* Radio button selecionado para banners */
.banner-radio.selected {
    background-color: #3b82f6;
    border-color: #3b82f6;
}

.banner-radio.selected::after {
    content: '';
    display: block;
    width: 6px;
    height: 6px;
    background-color: white;
    border-radius: 50%;
    margin: 1px;
}

/* Incluir modal de banners na lista de modais em tela cheia */
#name-banners-modal {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100vh !important;
    background: #111827 !important;    border-radius: 0 !important;
    margin: 0 !important;
    z-index: 9999 !important;
}

/* Estilos para o Modal de Visualização da Foto - VERSÃO CORRIGIDA */
#photo-viewer-modal {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;    width: 100% !important;    height: 100vh !important;
    background: transparent !important;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    z-index: 10000 !important;
    display: none !important; /* Começa oculto */
    align-items: center !important;
    justify-content: center !important;
}

/* Classe para mostrar o modal apenas quando necessário */
#photo-viewer-modal.show {
    display: flex !important;
}

#photo-viewer-modal .modal-content {
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    position: relative !important;
    animation: photoZoomIn 0.4s ease-out;
    max-width: 90vw;
    max-height: 90vh;
}

/* Imagem da foto - formato oval limpo */
#photo-viewer-modal img {
    width: 280px !important;
    height: 280px !important;
    border-radius: 50% !important;
    object-fit: cover !important;
    border: none !important;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6) !important;
}

/* Botão X elegante ao lado */
#close-photo-viewer-btn {
    position: absolute !important;
    top: 12px !important;
    right: 12px !important;
    background: rgba(31, 41, 55, 0.85) !important; /* cinza escuro opaco, bom contraste */
    border: none !important;
    border-radius: 50% !important;
    width: 44px !important;
    height: 44px !important;
    color: #fff !important;
    font-size: 22px !important;
    font-weight: bold !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    cursor: pointer !important;
    z-index: 11 !important;
    box-shadow: 0 4px 16px rgba(0,0,0,0.3);
}

#close-photo-viewer-btn:hover {
    background: #4f46e5 !important;
    color: #fff !important;
    transform: scale(1.08) !important;
}

@keyframes photoZoomIn {
    from {
        opacity: 0;
        transform: scale(0.7);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

/* Torna a foto do usuário nas configurações clicável */
#settings-modal .w-16.h-16.rounded-full {
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

#settings-modal .w-16.h-16.rounded-full:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
}

/* Responsividade para mobile */
@media (max-width: 768px) {
    #photo-viewer-modal img {
        width: 80vw !important;
        height: 80vw !important;
        max-width: 240px !important;
        max-height: 240px !important;
    }
    #close-photo-viewer-btn {
        top: 8px !important;
        right: 8px !important;
        width: 36px !important;
        height: 36px !important;
        font-size: 18px !important;
        z-index: 12 !important;
    }
}

@media (max-width: 480px) {
    #photo-viewer-modal img {
        width: 200px !important;
        height: 200px !important;
    }
    
    #close-photo-viewer-btn {
        top: 10px !important;
        right: 10px !important;
        width: 40px !important;
        height: 40px !important;
        font-size: 18px !important;        background: rgba(0, 0, 0, 0.8) !important;
    }
}

/* Estilos para notificações */
#notifications-btn {
    position: relative;
}

#notifications-badge {
    animation: pulse 2s infinite;
}

/* Modal de notificações */
#notifications-modal {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100vh !important;
    background: #111827 !important;
    border-radius: 0 !important;
    margin: 0 !important;
    z-index: 9999 !important;
}

.friend-request-item {
    border: 1px solid #374151;
    transition: all 0.2s ease;
}

.friend-request-item:hover {
    background-color: #4B5563;
    border-color: #6B7280;
}

/* Animação para novas notificações */
@keyframes notification-bounce {
    0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
    }
    40% {
        transform: translateY(-10px);
    }
    60% {
        transform: translateY(-5px);
    }
}

.notification-new {
    animation: notification-bounce 0.6s ease-in-out;
}

/* Estilos para tela de amigos */
.tab-button {
    transition: all 0.2s ease;
}

.tab-button.active {
    color: #60a5fa !important;
    border-bottom-color: #3b82f6 !important;
    background-color: #374151 !important;
}

/* Modal de busca global */
#global-search-modal {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100vh !important;
    background: #111827 !important;
    border-radius: 0 !important;
    margin: 0 !important;
    z-index: 9999 !important;
}

/* Estilos para resultados de busca */
.search-result-item {
    background: #374151;
    border: 1px solid #4B5563;
    border-radius: 12px;
    padding: 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: all 0.2s ease;
}

.search-result-item:hover {
    background: #4B5563;
    border-color: #6B7280;
    transform: translateY(-1px);
}

.user-status-online {
    background: #10b981;
}

.user-status-offline {
    background: #6b7280;
}

.user-status-away {
    background: #f59e0b;
}

.user-status-busy {
    background: #ef4444;
}

/* Animações */
@keyframes searchPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.search-pulse {
    animation: searchPulse 2s infinite;
}
</style>
<!-- Container Principal -->
<div id="app-container" class="h-screen flex flex-col bg-gray-900 hidden">
    <!-- Header -->
    <div class="bg-gray-800 border-b border-gray-700 px-4 py-3 flex items-center justify-between">
        <h1 class="text-white font-bold text-xl">7Chat</h1>
        <div class="flex items-center space-x-3">
            <!-- Foto do usuário -->
            <div id="user-profile-container" class="w-10 h-10 rounded-full bg-gray-600 border-2 border-gray-500 overflow-hidden cursor-pointer relative">
                <img id="user-profile-pic" src="" alt="Perfil" class="w-full h-full object-cover hidden">
                <svg id="user-profile-icon" class="w-6 h-6 text-gray-400 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
            </div>
            <!-- Botões do header -->
            <button id="notifications-btn" class="relative p-2 text-gray-400 hover:text-white transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                </svg>
                <span id="notifications-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
            </button>
        </div>
    </div>

    <!-- Conteúdo Principal -->
    <div class="flex-1 flex flex-col">
        <!-- Lista de Conversas -->
        <div class="bg-gray-800 border-b border-gray-700 p-4">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-white font-semibold">Conversas</h2>
                <button id="new-chat-btn" class="bg-blue-600 text-white px-3 py-1 rounded-lg text-sm hover:bg-blue-700 transition-colors">
                    Nova Conversa
                </button>
            </div>
            <div class="relative">
                <input id="search-conversations-input" type="text" placeholder="Buscar conversas..." class="w-full bg-gray-700 text-white px-4 py-2 rounded-lg pl-10 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <svg class="w-5 h-5 text-gray-400 absolute left-3 top-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </div>
        </div>
        
        <!-- Lista de Conversas -->
        <div class="flex-1 overflow-y-auto">
            <div id="conversations-list" class="space-y-2 p-4">
                <!-- Conversas aparecerão aqui -->
            </div>
            <div id="empty-state" class="flex flex-col items-center justify-center h-64 text-gray-500">
                <svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                </svg>
                <p class="text-lg font-medium mb-2">Nenhuma conversa ainda</p>
                <p class="text-sm text-center">Comece uma nova conversa ou aguarde mensagens</p>
            </div>
        </div>
    </div>
</div>

<!-- Tela de Login -->
<div id="login-screen" class="min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900 flex items-center justify-center p-4">
    <div class="bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md p-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">7Chat</h1>
            <p class="text-gray-400">Conecte-se com seus amigos</p>
        </div>
        
        <form id="login-form" class="space-y-6">
            <div>
                <label class="block text-gray-300 text-sm font-medium mb-2">Email</label>
                <input id="email-input" type="email" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="seu@email.com">
            </div>
            
            <div>
                <label class="block text-gray-300 text-sm font-medium mb-2">Senha</label>
                <input id="password-input" type="password" required class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="••••••••">
            </div>
            
            <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-300 font-medium">
                Entrar
            </button>
        </form>
        
        <div class="mt-6 text-center">
            <button id="main-guest-login-btn" class="text-blue-400 hover:text-blue-300 font-semibold">
                Entrar como convidado
            </button>
        </div>
    </div>
</div>

<!-- Tela de Amigos -->
<div id="friends-screen" class="hidden h-screen flex flex-col bg-gray-900">
    <!-- Header da tela de amigos -->
    <div class="bg-gray-800 border-b border-gray-700 px-4 py-3">
        <h1 class="text-white font-bold text-xl">Amigos</h1>
    </div>
    
    <!-- Conteúdo da tela de amigos -->
    <div class="flex-1 flex flex-col">
        <!-- Aqui vai o conteúdo da tela de amigos -->
        <div class="flex-1 flex items-center justify-center text-gray-500">
            <p>Tela de amigos em desenvolvimento...</p>
        </div>
    </div>
</div>

<!-- Navegação Inferior -->
<nav id="bottom-nav" class="hidden bg-gray-800 border-t border-gray-700">
    <div class="flex">
        <button id="nav-rooms" class="flex-1 flex flex-col items-center justify-center py-3 text-blue-500">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
            </svg>
            <span class="text-xs">Conversas</span>
        </button>
        
        <button id="nav-friends" class="flex-1 flex flex-col items-center justify-center py-3 text-gray-400">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
            </svg>
            <span class="text-xs">Amigos</span>
        </button>
        
        <button id="nav-settings" class="flex-1 flex flex-col items-center justify-center py-3 text-gray-400">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            <span class="text-xs">Configurações</span>
        </button>
    </div>
</nav>

<!-- ADICIONAR AQUI TODOS OS MODAIS QUE VOCÊ TINHA -->
<!-- Modal de Configurações -->
<div id="settings-modal" class="hidden modal fixed inset-0 bg-black bg-opacity-50 z-50">
    <!-- Conteúdo do modal de configurações -->
</div>

<!-- Scripts JavaScript -->
<script>
// TODO: Adicionar todo o JavaScript aqui
console.log('7Chat carregado!');

// Inicialização básica
document.addEventListener('DOMContentLoaded', function() {
    console.log('🚀 Inicializando aplicação...');
    
    // Mostrar tela de login inicialmente
    document.getElementById('login-screen').classList.remove('hidden');
});
</script>

</body>
</html>
</head>
<body>

<style>
/* Sistema de Conversas Privadas */
#chat-screen {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100vh !important;
    background: #111827 !important;
    z-index: 9999 !important;
    display: none;
    flex-direction: column;
}

#chat-screen.show {
    display: flex !important;
}

.chat-header {
    background: #1f2937;
    border-bottom: 1px solid #374151;
    padding: 16px 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    min-height: 70px;
}

.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 16px 20px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.message {
    max-width: 80%;
    padding: 12px 16px;
    border-radius: 18px;
    word-wrap: break-word;
    position: relative;
}

.message.sent {
    background: #3b82f6;
    color: white;
    align-self: flex-end;
    border-bottom-right-radius: 4px;
}

.message.received {
    background: #374151;
    color: #e5e7eb;
    align-self: flex-start;
    border-bottom-left-radius: 4px;
}

.message-time {
    font-size: 11px;
    opacity: 0.7;
    margin-top: 4px;
}

.chat-input-container {
    padding: 16px 20px;
    background: #1f2937;
    border-top: 1px solid #374151;
    display: flex;
    gap: 12px;
    align-items: center;
}

.chat-input {
    flex: 1;
    background: #374151;
    border: 1px solid #4b5563;
    border-radius: 25px;
    padding: 12px 16px;
    color: white;
    resize: none;
    max-height: 100px;
    min-height: 44px;
}

.chat-send-btn {
    width: 44px;
    height: 44px;
    background: #3b82f6;
    border: none;
    border-radius: 50%;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
}

.chat-send-btn:hover {
    background: #2563eb;
    transform: scale(1.05);
}

.chat-send-btn:disabled {
    background: #6b7280;
    cursor: not-allowed;
    transform: none;
}

.conversation-item {
    background: #374151;
    border: 1px solid #4b5563;
    border-radius: 12px;
    padding: 16px;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 8px;
}

.conversation-item:hover {
    background: #4b5563;
    transform: translateY(-1px);
}

.conversation-item.unread {
    background: #1e40af;
    border-color: #3b82f6;
}

.conversation-preview {
    color: #9ca3af;
    font-size: 14px;
    margin-top: 4px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.conversation-time {
    color: #6b7280;
    font-size: 12px;
}

.unread-badge {
    background: #ef4444;
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
}

.typing-indicator {
    display: flex;
    align-items: center;
    gap: 4px;
    color: #9ca3af;
    font-style: italic;
    margin-left: 20px;
}

.typing-dots {
    display: flex;
    gap: 2px;
}

.typing-dot {
    width: 4px;
    height: 4px;
    background: #9ca3af;
    border-radius: 50%;
    animation: typingDot 1.4s infinite;
}

.typing-dot:nth-child(2) {
    animation-delay: 0.2s;
}

.typing-dot:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes typingDot {
    0%, 60%, 100% { opacity: 0.3; }
    30% { opacity: 1; }
}

@media (max-width: 768px) {
    .chat-header {
        padding-top: max(16px, env(safe-area-inset-top, 0px));
        min-height: calc(70px + env(safe-area-inset-top, 0px));
    }
    
    .chat-input-container {
        padding-bottom: max(16px, env(safe-area-inset-bottom, 0px));
    }
}
</style>
</head>
<body class="bg-black text-gray-200"><!-- Menu de Navegação Inferior -->
    <div id="bottom-nav" class="hidden fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-700 shadow-lg z-50">
        <div class="flex justify-around text-gray-400">
            <a href="#" id="nav-friends" class="flex flex-col items-center justify-center p-3 text-center w-full hover:text-white transition-colors duration-300">
                <i class="fas fa-user-friends text-xl"></i>
                <span class="text-xs font-medium">Amigos</span>
            </a>
            <a href="#" id="nav-rooms" class="flex flex-col items-center justify-center p-3 text-center w-full text-indigo-400 border-t-2 border-indigo-500 hover:text-white transition-colors duration-300">
                <i class="fas fa-comments text-xl"></i>
                <span class="text-xs font-medium">Salas</span>
            </a>
            <a href="#" id="nav-settings" class="flex flex-col items-center justify-center p-3 text-center w-full hover:text-white transition-colors duration-300">
                <i class="fas fa-cog text-xl"></i>
                <span class="text-xs font-medium">Configuração</span>
            </a>
        </div>
    </div>

    <!-- TELA DE LOGIN -->
    <div id="login-screen" class="flex items-center justify-center h-full p-4 flex-col">
        <div class="w-full max-w-sm p-8 bg-gray-800/80 backdrop-blur-lg rounded-xl shadow-lg space-y-6 z-10 border border-gray-700">
            <h2 class="text-3xl font-extrabold text-center bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-cyan-400">7Chat</h2>
            <form id="login-form" class="space-y-4">
                <input id="email-input" type="email" required placeholder="E-mail" class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-700 text-white">
                <input id="password-input" type="password" required placeholder="Senha" class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-700 text-white">
                <button type="submit" class="mobile-btn w-full py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-semibold rounded-lg shadow-md hover:from-blue-600 hover:to-indigo-700 transition duration-300">
                    Entrar
                </button>
            </form>
            <div class="text-center">
                <span class="text-sm text-gray-500">ou</span>
                <button id="main-guest-login-btn" class="mobile-btn mt-2 text-blue-400 hover:text-blue-300 font-semibold">Entrar como convidado</button>
            </div>        </div>
    </div>

    <!-- TELA DE CONVERSA PRIVADA -->
    <div id="chat-screen">
        <!-- Header do Chat -->
        <div class="chat-header">
            <button id="back-to-chats-btn" class="w-10 h-10 rounded-full bg-gray-600 border border-gray-500 flex items-center justify-center hover:bg-gray-500 transition-colors">
                <i class="fas fa-arrow-left text-white"></i>
            </button>
            
            <div id="chat-user-avatar" class="w-10 h-10 rounded-full bg-gray-600 border-2 border-gray-400 overflow-hidden flex-shrink-0">
                <img class="w-full h-full object-cover hidden" alt="Avatar">
                <div class="w-full h-full flex items-center justify-center">
                    <i class="fas fa-user text-gray-300"></i>
                </div>
            </div>
            
            <div class="flex-1">
                <h3 id="chat-user-name" class="text-white font-semibold text-lg">Nome do Usuário</h3>
                <div class="flex items-center gap-2">
                    <div id="chat-user-status" class="w-2 h-2 rounded-full bg-gray-500"></div>
                    <span id="chat-user-status-text" class="text-gray-400 text-sm">Offline</span>
                </div>
            </div>
            
            <button id="chat-options-btn" class="w-10 h-10 rounded-full bg-gray-600 border border-gray-500 flex items-center justify-center hover:bg-gray-500 transition-colors">
                <i class="fas fa-ellipsis-v text-white"></i>
            </button>
        </div>
        
        <!-- Área de Mensagens -->
        <div id="chat-messages" class="chat-messages">
            <!-- Mensagens serão inseridas aqui via JavaScript -->
        </div>
        
        <!-- Indicador de digitação -->
        <div id="typing-indicator" class="typing-indicator hidden">
            <span id="typing-user-name">Usuário</span> está digitando
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>
        
        <!-- Input de Mensagem -->
        <div class="chat-input-container">
            <textarea 
                id="chat-input" 
                class="chat-input" 
                placeholder="Digite uma mensagem..."
                rows="1"
            ></textarea>
            <button id="chat-send-btn" class="chat-send-btn" disabled>
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- CONTAINER PRINCIPAL DO APP -->
    <div id="app-container" class="hidden h-full w-full relative overflow-hidden bg-gray-900">        <!-- Header superior -->
        <div class="bg-gray-800 px-4 py-3 flex justify-between items-center border-b border-gray-700 min-h-[60px]">
            <!-- Sino de notificações (esquerda) -->
            <div class="relative">
                <button id="notifications-btn" class="w-10 h-10 rounded-full bg-gray-700 border border-gray-600 flex items-center justify-center hover:bg-gray-600 transition-colors duration-200">
                    <i class="fas fa-bell text-gray-300 text-lg"></i>
                </button>
                <!-- Badge de notificação -->
                <span id="notifications-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center">0</span>
            </div>
            
            <!-- Título Chats (centro) -->
            <div class="flex-1 flex justify-center">
                <h1 class="text-white font-semibold text-xl">
                    Chats
                </h1>
            </div>
            
            <!-- Foto do usuário (direita) -->
            <div id="user-profile-btn" class="w-10 h-10 rounded-full bg-gray-600 border-2 border-gray-500 overflow-hidden cursor-pointer hover:ring-2 hover:ring-blue-400 transition-all duration-200">
                <img id="user-profile-pic" class="w-full h-full object-cover hidden" alt="Perfil">
                <svg id="user-profile-icon" class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
            </div>
        </div>        <!-- Área de conteúdo principal -->
        <div class="p-4 pb-20 h-full overflow-auto">
            <!-- Barra de busca para conversas -->
            <div class="relative mb-4">
                <div class="bg-gray-700 rounded-lg px-3 py-2 flex items-center space-x-2 min-h-[44px]">
                    <svg class="w-4 h-4 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    <input 
                        type="text" 
                        id="search-conversations-input" 
                        placeholder="Buscar conversas" 
                        class="bg-transparent flex-1 text-white placeholder-gray-400 focus:outline-none text-base min-w-0"
                    />
                </div>
            </div>

            <!-- Lista de Conversas Ativas -->
            <div id="conversations-list">
                <!-- Conversas serão inseridas aqui via JavaScript -->
            </div>
        </div>
    </div>    <!-- Tela de Amigos -->
    <div id="friends-screen" class="hidden h-full w-full flex flex-col bg-gray-900 text-white pb-20">
        <!-- Header da tela de amigos -->
        <div class="bg-gray-800 px-4 py-3 flex justify-between items-center border-b border-gray-700 min-h-[60px]">
            <!-- Título -->
            <div class="flex-1 flex justify-center">
                <h1 class="text-white font-semibold text-xl">Amigos</h1>
            </div>
            
            <!-- Botão de busca global -->
            <button id="global-search-btn" class="w-10 h-10 rounded-full bg-gray-700 border border-gray-600 flex items-center justify-center hover:bg-gray-600 transition-colors duration-200">
                <i class="fas fa-search text-gray-300 text-lg"></i>
            </button>
        </div>
        
        <!-- Conteúdo da tela de amigos -->
        <div class="flex-1 overflow-auto">
            <!-- Abas -->
            <div class="bg-gray-800 border-b border-gray-700">
                <div class="flex">
                    <button id="tab-online" class="flex-1 py-3 px-4 text-center font-medium text-blue-400 border-b-2 border-blue-500 bg-gray-700">
                        Online
                    </button>
                    <button id="tab-all" class="flex-1 py-3 px-4 text-center font-medium text-gray-400 hover:text-white transition-colors">
                        Todos
                    </button>
                    <button id="tab-pending" class="flex-1 py-3 px-4 text-center font-medium text-gray-400 hover:text-white transition-colors">
                        Pendentes
                    </button>
                    <button id="tab-blocked" class="flex-1 py-3 px-4 text-center font-medium text-gray-400 hover:text-white transition-colors">
                        Bloqueados
                    </button>
                </div>
            </div>
            
            <!-- Conteúdo das abas -->
            <div class="p-4">
                <!-- Aba Online -->
                <div id="content-online" class="space-y-3">
                    <div class="text-center text-gray-400 py-12">
                        <i class="fas fa-users text-6xl text-gray-600 mb-4"></i>
                        <p class="text-lg mb-2">Nenhum amigo online</p>
                        <p class="text-sm">Seus amigos aparecerão aqui quando estiverem online</p>
                    </div>
                </div>
                
                <!-- Aba Todos -->
                <div id="content-all" class="hidden space-y-3">
                    <div class="text-center text-gray-400 py-12">
                        <i class="fas fa-user-friends text-6xl text-gray-600 mb-4"></i>
                        <p class="text-lg mb-2">Você ainda não tem amigos</p>
                        <p class="text-sm">Use a busca para encontrar e adicionar amigos</p>
                    </div>
                </div>
                
                <!-- Aba Pendentes -->
                <div id="content-pending" class="hidden space-y-3">
                    <div class="text-center text-gray-400 py-12">
                        <i class="fas fa-clock text-6xl text-gray-600 mb-4"></i>
                        <p class="text-lg mb-2">Nenhuma solicitação pendente</p>
                        <p class="text-sm">Solicitações de amizade enviadas aparecerão aqui</p>
                    </div>
                </div>
                
                <!-- Aba Bloqueados -->
                <div id="content-blocked" class="hidden space-y-3">
                    <div class="text-center text-gray-400 py-12">
                        <i class="fas fa-ban text-6xl text-gray-600 mb-4"></i>
                        <p class="text-lg mb-2">Nenhum usuário bloqueado</p>
                        <p class="text-sm">Usuários bloqueados aparecerão aqui</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Busca Global -->
    <div id="global-search-modal" class="hidden modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[80]">
        <div class="modal-content bg-gray-800 w-full h-full max-w-none max-h-none border-radius-0">
            <!-- Header -->
            <div class="modal-header bg-gray-800 border-b border-gray-700 flex items-center px-4 py-3">
                <button id="close-global-search-btn" class="text-gray-400 hover:text-gray-300 mr-4">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                <h3 class="text-white font-semibold text-lg">Buscar Usuários</h3>
            </div>
            
            <!-- Barra de busca -->
            <div class="p-4 border-b border-gray-700">
                <div class="relative">
                    <div class="bg-gray-700 rounded-lg px-3 py-3 flex items-center space-x-2">
                        <svg class="w-5 h-5 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <input 
                            type="text" 
                            id="global-search-input" 
                            placeholder="Digite o nome do usuário..." 
                            class="bg-transparent flex-1 text-white placeholder-gray-400 focus:outline-none text-base min-w-0"
                        >
                    </div>
                </div>
            </div>
            
            <!-- Resultados da busca -->
            <div class="flex-1 overflow-y-auto">
                <!-- Loading -->
                <div id="search-loading" class="hidden text-center py-8">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                    <p class="text-gray-400 mt-2">Buscando...</p>
                </div>
                
                <!-- Lista de resultados -->
                <div id="search-results" class="p-4 space-y-3">
                    <!-- Resultados aparecerão aqui -->
                </div>
                
                <!-- Estado inicial -->
                <div id="search-initial-state" class="text-center text-gray-400 py-12">
                    <i class="fas fa-search text-6xl text-gray-600 mb-4"></i>
                    <p class="text-lg mb-2">Buscar Usuários</p>
                    <p class="text-sm">Digite o nome de um usuário para encontrá-lo</p>
                </div>
                
                <!-- Nenhum resultado -->
                <div id="search-no-results" class="hidden text-center text-gray-400 py-12">
                    <i class="fas fa-user-slash text-6xl text-gray-600 mb-4"></i>
                    <p class="text-lg mb-2">Nenhum usuário encontrado</p>
                    <p class="text-sm">Tente buscar por outro nome</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Container para convidados -->
    <div id="guest-container" class="hidden h-full w-full relative overflow-hidden">
        <div class="h-full flex items-center justify-center text-center p-4">
            <p class="text-white">Modo convidado ativo</p>
        </div>
    </div>    <!-- Elementos de notificação -->
    <div id="notification-toast" class="hidden fixed bottom-5 right-5 bg-blue-500 text-white py-2 px-4 rounded-lg shadow-xl z-[101]"></div>

    <!-- Modal melhorado para trocar nome -->
    <div id="custom-prompt-modal" class="hidden modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[80] p-4">
        <div class="modal-content bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md space-y-6 border border-gray-700">
            <!-- Header -->
            <div class="flex items-center justify-between">
                <h3 id="custom-prompt-title" class="text-2xl font-bold text-white">Alterar Nome</h3>
                <button id="custom-prompt-close-btn" class="text-gray-500 hover:text-gray-300 text-2xl transition-colors">&times;</button>
            </div>
            
            <!-- Mensagem -->
            <div class="text-center">
                <svg class="w-16 h-16 text-blue-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                <p id="custom-prompt-message" class="text-gray-300 text-lg mb-4">Digite seu novo nome de usuário:</p>
            </div>
            
            <!-- Input com label -->
            <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-400">Novo nome:</label>
                <input 
                    type="text" 
                    id="custom-prompt-input" 
                    placeholder="Digite aqui..." 
                    class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-700 text-white placeholder-gray-400 transition-all duration-200"
                    maxlength="30"
                />
                <p class="text-xs text-gray-500">Máximo 30 caracteres</p>
            </div>
            
            <!-- Botões -->
            <div class="flex space-x-3 pt-2">
                <button id="custom-prompt-cancel-btn" class="flex-1 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition duration-300 font-medium">
                    Cancelar
                </button>
                <button id="custom-prompt-ok-btn" class="flex-1 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300 font-medium">
                    Confirmar                </button>
            </div>
        </div>
    </div>

<!-- Modal de Configurações ATUALIZADO -->
<div id="settings-modal" class="hidden modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[80]">
    <div class="modal-content bg-gray-800 w-full h-full max-w-none max-h-none border-radius-0">
        <!-- Header -->
        <div class="modal-header bg-gray-800 border-b border-gray-700 flex items-center px-4 py-3">
            <button id="close-settings-btn" class="text-gray-400 hover:text-gray-300 mr-4">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </button>
            <h3 class="text-white font-semibold text-lg">Configurações</h3>
        </div>
        
        <!-- Conteúdo -->
        <div class="p-6">
            <!-- Seção do Usuário -->            <div class="flex items-center space-x-4 mb-8">
                <div class="relative">
                    <div id="settings-photo-container" class="w-16 h-16 rounded-full bg-gray-600 border-2 border-gray-500 overflow-hidden">
                        <img id="settings-user-pic" class="w-full h-full object-cover hidden" alt="Perfil">
                        <svg id="settings-user-icon" class="w-8 h-8 text-gray-400 m-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                </div>
                <div class="flex-1">
                    <h4 id="settings-user-name" class="text-white font-medium text-lg">Usuário</h4>
                    <p id="settings-user-status" class="text-gray-400 text-sm">Olá! Eu estou usando o 7Chat...</p>
                </div>
            </div>
            
            <!-- Opções de Configuração -->
            <div class="space-y-4">
                <!-- Nome do Usuário -->
                <div id="settings-edit-name-option" class="profile-detail-section flex items-center justify-between cursor-pointer">
                    <div>
                        <div class="profile-detail-label">Nome</div>
                        <div id="settings-display-name" class="profile-detail-value">Usuário</div>
                    </div>
                    <svg class="w-5 h-5 profile-detail-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </div>
                
                <!-- Recados -->
                <div id="settings-edit-status-option" class="profile-detail-section flex items-center justify-between cursor-pointer">
                    <div>
                        <div class="profile-detail-label">Recados</div>
                        <div id="settings-display-status" class="profile-detail-value">Olá! Eu estou usando o 7Chat...</div>
                    </div>
                    <svg class="w-5 h-5 profile-detail-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>                </div>
                  <!-- Efeitos do Nome -->
                <div id="settings-name-effects-option" class="profile-detail-section flex items-center justify-between cursor-pointer">
                    <div>
                        <div class="profile-detail-label">Efeitos do Nome</div>
                        <div class="profile-detail-value">Personalizar aparência</div>
                    </div>
                    <svg class="w-5 h-5 profile-detail-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </div>
                
                <!-- Banner do Nome -->
                <div id="settings-name-banners-option" class="profile-detail-section flex items-center justify-between cursor-pointer">
                    <div>
                        <div class="profile-detail-label">Banner do Nome</div>
                        <div class="profile-detail-value">Decorações nas salas</div>
                    </div>
                    <svg class="w-5 h-5 profile-detail-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </div>
                
                <!-- Logout -->
                <div id="logout-option" class="profile-detail-section flex items-center justify-between cursor-pointer">
                    <div>
                        <div class="profile-detail-label">Sair</div>
                        <div class="profile-detail-value text-red-400">Fazer logout</div>
                    </div>
                    <svg class="w-5 h-5 profile-detail-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>                </div>            </div>
        </div>
    </div>
</div>

<!-- Modal de Notificações -->
<div id="notifications-modal" class="hidden modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[80]">
    <div class="modal-content bg-gray-800 w-full h-full max-w-none max-h-none border-radius-0">
        <!-- Header -->
        <div class="modal-header bg-gray-800 border-b border-gray-700 flex items-center px-4 py-3">
            <button id="close-notifications-btn" class="text-gray-400 hover:text-gray-300 mr-4">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </button>
            <h3 class="text-white font-semibold text-lg">Notificações</h3>
        </div>
        
        <!-- Conteúdo -->
        <div class="flex-1 overflow-y-auto">
            <!-- Lista de solicitações de amizade -->
            <div id="friend-requests-list" class="p-4 space-y-3">
                <!-- Exemplo de solicitação -->
                <div class="friend-request-item bg-gray-700 rounded-lg p-4 flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 rounded-full bg-gray-600 overflow-hidden">
                            <img src="https://placehold.co/48x48/4f46e5/ffffff?text=U" alt="Avatar" class="w-full h-full object-cover">
                        </div>
                        <div>
                            <h4 class="text-white font-medium">João Silva</h4>
                            <p class="text-gray-400 text-sm">Quer ser seu amigo</p>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button class="accept-friend-btn bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-lg text-sm transition-colors">
                            Aceitar
                        </button>
                        <button class="reject-friend-btn bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-lg text-sm transition-colors">
                            Recusar
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Estado vazio -->
            <div id="notifications-empty-state" class="hidden text-center text-gray-400 py-12">
                <i class="fas fa-bell-slash text-6xl text-gray-600 mb-4"></i>
                <p class="text-lg mb-2">Nenhuma notificação</p>
                <p class="text-sm">Você não tem solicitações de amizade pendentes</p>
            </div>
        </div>    </div>
</div>

<!-- Modal de Busca Global -->
<div id="global-search-modal" class="hidden modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[80]">
    <div class="modal-content bg-gray-800 w-full h-full max-w-none max-h-none border-radius-0">
        <!-- Header -->
        <div class="modal-header bg-gray-800 border-b border-gray-700 flex items-center px-4 py-3">
            <button id="close-global-search-btn" class="text-gray-400 hover:text-gray-300 mr-4">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </button>
            <h3 class="text-white font-semibold text-lg">Buscar Usuários</h3>
        </div>
        
        <!-- Barra de busca -->
        <div class="p-4 border-b border-gray-700">
            <div class="relative">
                <div class="bg-gray-700 rounded-lg px-3 py-3 flex items-center space-x-2">
                    <svg class="w-5 h-5 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    <input 
                        type="text" 
                        id="global-search-input" 
                        placeholder="Digite o nome do usuário..." 
                        class="bg-transparent flex-1 text-white placeholder-gray-400 focus:outline-none text-base min-w-0"
                    >
                </div>
            </div>
        </div>
        
        <!-- Resultados da busca -->
        <div class="flex-1 overflow-y-auto">
            <!-- Loading -->
            <div id="search-loading" class="hidden text-center py-8">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                <p class="text-gray-400 mt-2">Buscando...</p>
            </div>
            
            <!-- Lista de resultados -->
            <div id="search-results" class="p-4 space-y-3">
                <!-- Resultados aparecerão aqui -->
            </div>
            
            <!-- Estado inicial -->
            <div id="search-initial-state" class="text-center text-gray-400 py-12">
                <i class="fas fa-search text-6xl text-gray-600 mb-4"></i>
                <p class="text-lg mb-2">Buscar Usuários</p>
                <p class="text-sm">Digite o nome de um usuário para encontrá-lo</p>
            </div>
            
            <!-- Nenhum resultado -->
            <div id="search-no-results" class="hidden text-center text-gray-400 py-12">
                <i class="fas fa-user-slash text-6xl text-gray-600 mb-4"></i>
                <p class="text-lg mb-2">Nenhum usuário encontrado</p>
                <p class="text-sm">Tente buscar por outro nome</p>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Visualização da Foto -->
<div id="photo-viewer-modal" class="modal hidden">
    <div class="modal-content flex items-center justify-center relative">
        <img id="photo-viewer-image" src="" alt="Perfil" class="hidden">
        <svg id="photo-viewer-icon" class="w-20 h-20 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
        </svg>
        <div id="photo-viewer-username" class="absolute bottom-4 text-white font-medium text-lg hidden">Usuário</div>
        <button id="close-photo-viewer-btn" type="button">&times;</button>
    </div>
</div>

<!-- Modal de Edição de Nome com Novo Layout -->
<div id="edit-name-modal" class="hidden modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[90]">
    <div class="modal-content bg-gray-800 w-full h-full max-w-none max-h-none border-radius-0">
        <!-- Header do Modal -->        <div class="modal-header bg-gray-800 border-b border-gray-700 flex items-center justify-between px-4 py-3">            <button id="cancel-edit-name-btn" class="text-blue-400 hover:text-blue-300 font-normal text-sm">
                Cancelar
            </button>
            <h3 class="text-white font-semibold text-lg">Usuário</h3>
            <button id="save-name-btn" class="text-blue-400 hover:text-blue-300 font-medium">
                Salvar
            </button>
        </div>
        
        <!-- Conteúdo do Modal -->
        <div class="p-6">
            <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-400">Nome</label>
                <input 
                    type="text" 
                    id="edit-name-input" 
                    placeholder="Digite seu nome..." 
                    class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-700 text-white placeholder-gray-400"
                    maxlength="30"
                />
                <p class="text-xs text-gray-500">Máximo 30 caracteres</p>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Edição de Recados -->
<div id="edit-status-modal" class="hidden modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[90]">
    <div class="modal-content bg-gray-800 w-full h-full max-w-none max-h-none border-radius-0">
        <!-- Header do Modal -->        <div class="modal-header bg-gray-800 border-b border-gray-700 flex items-center justify-between px-4 py-3">
            <button id="cancel-edit-status-btn" class="text-blue-400 hover:text-blue-300 font-normal text-sm">
                Cancelar
            </button>
            <h3 class="text-white font-semibold text-lg">Recados</h3>
            <button id="save-status-btn" class="text-blue-400 hover:text-blue-300 font-medium">
                Salvar
            </button>
        </div>
        
        <!-- Conteúdo do Modal -->
        <div class="p-6">
            <div class="space-y-2">
                <label class="block text-sm font-medium text-gray-400">Status</label>                <textarea 
                    id="edit-status-input" 
                    placeholder="Adicione um recado..." 
                    class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-700 text-white placeholder-gray-400 resize-none"
                    rows="2"
                    maxlength="139"
                ></textarea>
                <p class="text-xs text-gray-500">Máximo 139 caracteres</p>
            </div>
        </div>    </div>
</div>

<!-- Modal de Efeitos do Nome -->
<div id="name-effects-modal" class="hidden modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[90]">
    <div class="modal-content bg-gray-800 w-full h-full max-w-none max-h-none border-radius-0">
        <!-- Header do Modal -->
        <div class="modal-header bg-gray-800 border-b border-gray-700 flex items-center justify-between px-4 py-3">
            <button id="cancel-name-effects-btn" class="text-blue-400 hover:text-blue-300 font-normal text-sm">
                Cancelar
            </button>
            <h3 class="text-white font-semibold text-lg">Efeitos do Nome</h3>
            <button id="save-name-effects-btn" class="text-blue-400 hover:text-blue-300 font-medium">
                Salvar
            </button>
        </div>
        
        <!-- Conteúdo do Modal -->
        <div class="p-6">
            <!-- Preview do nome -->
            <div class="text-center mb-6">
                <p class="text-gray-400 text-sm mb-2">Prévia:</p>
                <h2 id="name-preview" class="text-2xl font-bold text-white">Seu Nome</h2>
            </div>
            
            <!-- Opções de efeitos -->
            <div class="space-y-3">
                <div class="effect-option flex items-center justify-between p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors" data-effect="none">
                    <span class="text-white font-medium">Sem efeito</span>
                    <div class="w-4 h-4 border-2 border-blue-400 rounded-full effect-radio"></div>
                </div>
                
                <div class="effect-option flex items-center justify-between p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors" data-effect="rainbow">
                    <span class="name-effect-rainbow font-medium text-lg">Arco-íris</span>
                    <div class="w-4 h-4 border-2 border-blue-400 rounded-full effect-radio"></div>
                </div>
                
                <div class="effect-option flex items-center justify-between p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors" data-effect="gold">
                    <span class="name-effect-gold font-medium text-lg">Dourado</span>
                    <div class="w-4 h-4 border-2 border-blue-400 rounded-full effect-radio"></div>
                </div>
                
                <div class="effect-option flex items-center justify-between p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors" data-effect="neon">
                    <span class="name-effect-neon font-medium text-lg">Neon</span>
                    <div class="w-4 h-4 border-2 border-blue-400 rounded-full effect-radio"></div>
                </div>
                
                <div class="effect-option flex items-center justify-between p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors" data-effect="holographic">
                    <span class="name-effect-holographic font-medium text-lg">Holográfico</span>
                    <div class="w-4 h-4 border-2 border-blue-400 rounded-full effect-radio"></div>
                </div>
                
                <div class="effect-option flex items-center justify-between p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors" data-effect="sunset">
                    <span class="name-effect-sunset font-medium text-lg">Pôr do Sol</span>
                    <div class="w-4 h-4 border-2 border-blue-400 rounded-full effect-radio"></div>
                </div>
                
                <div class="effect-option flex items-center justify-between p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors" data-effect="crystal">
                    <span class="name-effect-crystal font-medium text-lg">Cristal</span>
                    <div class="w-4 h-4 border-2 border-blue-400 rounded-full effect-radio"></div>
                </div>
                
                <div class="effect-option flex items-center justify-between p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors" data-effect="fire">
                    <span class="name-effect-fire font-medium text-lg">Fogo</span>
                    <div class="w-4 h-4 border-2 border-blue-400 rounded-full effect-radio"></div>
                </div>
                
                <div class="effect-option flex items-center justify-between p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors" data-effect="ocean">
                    <span class="name-effect-ocean font-medium text-lg">Oceano</span>
                    <div class="w-4 h-4 border-2 border-blue-400 rounded-full effect-radio"></div>
                </div>
            </div>        </div>
    </div>
</div>

<!-- Modal de Banners do Nome -->
<div id="name-banners-modal" class="hidden modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[90]">
    <div class="modal-content bg-gray-800 w-full h-full max-w-none max-h-none border-radius-0">
        <!-- Header do Modal -->
        <div class="modal-header bg-gray-800 border-b border-gray-700 flex items-center justify-between px-4 py-3">
            <button id="cancel-name-banners-btn" class="text-blue-400 hover:text-blue-300 font-normal text-sm">
                Cancelar
            </button>
            <h3 class="text-white font-semibold text-lg">Banner do Nome</h3>
            <button id="save-name-banners-btn" class="text-blue-400 hover:text-blue-300 font-medium">
                Salvar
            </button>
        </div>
        
        <!-- Conteúdo do Modal -->
        <div class="p-6">
            <!-- Preview do banner -->
            <div class="text-center mb-6">
                <p class="text-gray-400 text-sm mb-2">Prévia (apenas em salas):</p>
                <div class="inline-block relative">
                    <div id="banner-preview-bg" class="absolute inset-0 rounded-lg"></div>
                    <h2 id="banner-preview-name" class="relative text-xl font-bold text-white px-4 py-2 z-10">Seu Nome</h2>
                </div>
                <p class="text-xs text-gray-500 mt-2">Banners aparecem apenas nas mensagens de chat</p>
            </div>
            
            <!-- Opções de banners -->
            <div class="space-y-3">
                <div class="banner-option flex items-center justify-between p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors" data-banner="none">
                    <span class="text-white font-medium">Sem banner</span>
                    <div class="w-4 h-4 border-2 border-blue-400 rounded-full banner-radio"></div>
                </div>
                
                <div class="banner-option flex items-center justify-between p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors" data-banner="heart-pink">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-6 bg-gradient-to-r from-pink-400 to-pink-500 rounded-sm relative overflow-hidden">
                            <div class="absolute inset-0 opacity-60">❤️✨</div>
                        </div>
                        <span class="text-white font-medium">Coração Rosa</span>
                    </div>
                    <div class="w-4 h-4 border-2 border-blue-400 rounded-full banner-radio"></div>
                </div>
                
                <div class="banner-option flex items-center justify-between p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors" data-banner="stars-gold">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-6 bg-gradient-to-r from-yellow-400 to-yellow-500 rounded-sm relative overflow-hidden">
                            <div class="absolute inset-0 opacity-60">⭐✨</div>
                        </div>
                        <span class="text-white font-medium">Estrelas Douradas</span>
                    </div>
                    <div class="w-4 h-4 border-2 border-blue-400 rounded-full banner-radio"></div>
                </div>
                
                <div class="banner-option flex items-center justify-between p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors" data-banner="nature-green">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-6 bg-gradient-to-r from-green-400 to-green-500 rounded-sm relative overflow-hidden">
                            <div class="absolute inset-0 opacity-60">🌿🍃</div>
                        </div>
                        <span class="text-white font-medium">Natureza</span>
                    </div>
                    <div class="w-4 h-4 border-2 border-blue-400 rounded-full banner-radio"></div>
                </div>
                
                <div class="banner-option flex items-center justify-between p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors" data-banner="tech-blue">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-6 bg-gradient-to-r from-blue-400 to-blue-500 rounded-sm relative overflow-hidden">
                            <div class="absolute inset-0 opacity-60">💎⚡</div>
                        </div>
                        <span class="text-white font-medium">Tecnológico</span>
                    </div>
                    <div class="w-4 h-4 border-2 border-blue-400 rounded-full banner-radio"></div>
                </div>
                
                <div class="banner-option flex items-center justify-between p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors" data-banner="romantic-purple">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-6 bg-gradient-to-r from-purple-400 to-purple-500 rounded-sm relative overflow-hidden">
                            <div class="absolute inset-0 opacity-60">🌸💜</div>
                        </div>
                        <span class="text-white font-medium">Romântico</span>
                    </div>
                    <div class="w-4 h-4 border-2 border-blue-400 rounded-full banner-radio"></div>
                </div>
                
                <div class="banner-option flex items-center justify-between p-3 bg-gray-700 rounded-lg cursor-pointer hover:bg-gray-600 transition-colors" data-banner="galaxy-space">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-6 bg-gradient-to-r from-indigo-400 to-purple-500 rounded-sm relative overflow-hidden">
                            <div class="absolute inset-0 opacity-60">🌌🚀</div>
                        </div>
                        <span class="text-white font-medium">Galáxia</span>
                    </div>
                    <div class="w-4 h-4 border-2 border-blue-400 rounded-full banner-radio"></div>
                </div>            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
    // Firebase Configuration - VERSÃO CORRIGIDA
    const firebaseConfig = {
        apiKey: "AIzaSyCyidXzqqe-rrcF0QrBQ2iSIR_mf0tpMd0",
        authDomain: "seu-projeto-chat.firebaseapp.com",
        databaseURL: "https://seu-projeto-chat-default-rtdb.firebaseio.com",
        projectId: "seu-projeto-chat",
        storageBucket: "seu-projeto-chat.firebasestorage.app",
        messagingSenderId: "259194791953",
        appId: "1:259194791953:web:587ea979f1f26aff2629b0"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);

    // Inicializar serviços
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Variáveis globais
    let currentUser = null;
    let unsubscribeAuth = null;

    console.log('🔥 Firebase inicializado com sucesso!');

    // --- FUNÇÕES AUXILIARES ---
    function showNotification(message, type = 'info') {
        const toast = document.getElementById('notification-toast');
        toast.textContent = message;
        toast.className = `fixed bottom-5 right-5 py-2 px-4 rounded-lg shadow-xl z-[101] ${
            type === 'error' ? 'bg-red-500' : 'bg-blue-500'
        } text-white`;
        toast.classList.remove('hidden');
        setTimeout(() => toast.classList.add('hidden'), 3000);
    }    function showCustomPrompt(title, message) {
        return new Promise((resolve) => {
            const modal = document.getElementById('custom-prompt-modal');
            const titleElement = document.getElementById('custom-prompt-title');
            const messageElement = document.getElementById('custom-prompt-message');
            const input = document.getElementById('custom-prompt-input');
            const okBtn = document.getElementById('custom-prompt-ok-btn');
            const cancelBtn = document.getElementById('custom-prompt-cancel-btn');
            const closeBtn = document.getElementById('custom-prompt-close-btn');
            
            // Configurar conteúdo
            titleElement.textContent = title;
            messageElement.textContent = message;
            input.value = '';
            
            // Função para fechar e cancelar
            const closeModal = () => {
                modal.classList.add('hidden');
                resolve(null); // Retorna null quando cancela
            };
            
            // Função para confirmar
            const confirmAction = () => {
                const value = input.value.trim();
                if (value) {
                    modal.classList.add('hidden');
                    resolve(value);
                } else {
                    // Se estiver vazio, destacar o input
                    input.classList.add('ring-2', 'ring-red-500');
                    setTimeout(() => {
                        input.classList.remove('ring-2', 'ring-red-500');
                    }, 1000);
                }
            };
            
            // Event listeners
            okBtn.onclick = confirmAction;
            cancelBtn.onclick = closeModal;
            closeBtn.onclick = closeModal;
            
            // Fechar clicando fora
            modal.onclick = (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            };
            
            // Enter para confirmar, Escape para cancelar
            input.onkeydown = (e) => {
                if (e.key === 'Enter') {
                    confirmAction();
                } else if (e.key === 'Escape') {
                    closeModal();
                }
            };
            
            // Mostrar modal e focar no input
            modal.classList.remove('hidden');
            setTimeout(() => input.focus(), 100);
        });
    }

    function updateNav(activeElement) {
        const navItems = document.querySelectorAll('#nav-friends, #nav-rooms, #nav-settings');
        navItems.forEach(item => {
            item.classList.remove('text-indigo-400', 'border-t-2', 'border-indigo-500');
            item.classList.add('text-gray-400');
        });
          activeElement.classList.remove('text-gray-400');
        activeElement.classList.add('text-indigo-400', 'border-t-2', 'border-indigo-500');
    }
</script>

<script>
// ==================== SISTEMA DE CONVERSAS PRIVADAS ====================

class ConversationManager {
    constructor() {
        this.conversations = this.loadConversations();
        this.currentChatUser = null;
        this.isInitialized = false;
    }

    init() {
        // Verificar se os elementos existem antes de inicializar
        if (!this.checkRequiredElements()) {
            console.log('Elementos necessários não encontrados, aguardando...');
            setTimeout(() => this.init(), 1000);
            return;
        }

        this.bindEvents();
        this.renderConversations();
        this.setupChatInput();
        this.isInitialized = true;
        console.log('✅ Sistema de conversas inicializado!');
    }

    checkRequiredElements() {
        const requiredElements = [
            'conversations-list',
            'search-conversations-input'
        ];

        return requiredElements.every(id => {
            const element = document.getElementById(id);
            if (!element) {
                console.log(`❌ Elemento não encontrado: ${id}`);
                return false;
            }
            return true;
        });
    }

    bindEvents() {
        // Eventos do chat (verificar se existem primeiro)
        const backBtn = document.getElementById('back-to-chats-btn');
        if (backBtn) {
            backBtn.addEventListener('click', () => this.closeChatScreen());
        }

        const sendBtn = document.getElementById('chat-send-btn');
        if (sendBtn) {
            sendBtn.addEventListener('click', () => this.sendMessage());
        }

        const chatInput = document.getElementById('chat-input');
        if (chatInput) {
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    this.sendMessage();
                }
            });
        }

        // Busca de conversas
        const searchInput = document.getElementById('search-conversations-input');
        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                this.filterConversations(e.target.value);
            });
        }
    }

    openChat(userName, userAvatar = null, userStatus = 'online') {
        if (!this.isInitialized) {
            console.log('Sistema não inicializado, tentando inicializar...');
            setTimeout(() => this.openChat(userName, userAvatar, userStatus), 1000);
            return;
        }

        this.currentChatUser = {
            name: userName,
            avatar: userAvatar,
            status: userStatus
        };

        // Configurar header do chat
        const chatUserName = document.getElementById('chat-user-name');
        const chatUserStatus = document.getElementById('chat-user-status-text');
        const statusDot = document.getElementById('chat-user-status');

        if (chatUserName) chatUserName.textContent = userName;
        if (chatUserStatus) chatUserStatus.textContent = userStatus === 'online' ? 'Online' : 'Offline';
        if (statusDot) {
            statusDot.className = `w-2 h-2 rounded-full ${userStatus === 'online' ? 'bg-green-500' : 'bg-gray-500'}`;
        }

        // Configurar avatar
        const avatarContainer = document.getElementById('chat-user-avatar');
        if (avatarContainer) {
            const avatarImg = avatarContainer.querySelector('img');
            if (userAvatar && avatarImg) {
                avatarImg.src = userAvatar;
                avatarImg.classList.remove('hidden');
                const iconDiv = avatarContainer.querySelector('div');
                if (iconDiv) iconDiv.classList.add('hidden');
            } else {
                if (avatarImg) avatarImg.classList.add('hidden');
                const iconDiv = avatarContainer.querySelector('div');
                if (iconDiv) iconDiv.classList.remove('hidden');
            }
        }

        // Carregar mensagens existentes
        this.loadChatMessages(userName);

        // Mostrar tela de chat
        const chatScreen = document.getElementById('chat-screen');
        if (chatScreen) {
            chatScreen.classList.add('show');
        }
        
        // Focar no input
        setTimeout(() => {
            const input = document.getElementById('chat-input');
            if (input) input.focus();
        }, 300);

        // Criar conversa se não existir
        if (!this.conversations[userName]) {
            this.conversations[userName] = {
                name: userName,
                avatar: userAvatar,
                status: userStatus,
                messages: [],
                lastMessage: '',
                lastMessageTime: new Date().toISOString(),
                unreadCount: 0
            };
            this.saveConversations();
            this.renderConversations();
        }
    }

    closeChatScreen() {
        const chatScreen = document.getElementById('chat-screen');
        if (chatScreen) {
            chatScreen.classList.remove('show');
        }
        this.currentChatUser = null;
    }

    sendMessage() {
        const input = document.getElementById('chat-input');
        if (!input) return;

        const message = input.value.trim();
        
        if (!message || !this.currentChatUser) return;

        const messageData = {
            text: message,
            time: new Date().toISOString(),
            sender: 'me'
        };

        // Adicionar mensagem ao chat
        this.addMessageToChat(messageData);
        
        // Salvar na conversa
        if (!this.conversations[this.currentChatUser.name]) {
            this.conversations[this.currentChatUser.name] = {
                name: this.currentChatUser.name,
                avatar: this.currentChatUser.avatar,
                status: this.currentChatUser.status,
                messages: [],
                lastMessage: '',
                lastMessageTime: new Date().toISOString(),
                unreadCount: 0
            };
        }

        this.conversations[this.currentChatUser.name].messages.push(messageData);
        this.conversations[this.currentChatUser.name].lastMessage = message;
        this.conversations[this.currentChatUser.name].lastMessageTime = messageData.time;
        
        this.saveConversations();
        this.renderConversations();

        // Limpar input
        input.value = '';
        this.updateSendButton();

        // Simular resposta automática
        this.simulateResponse();
    }

    addMessageToChat(messageData) {
        const messagesContainer = document.getElementById('chat-messages');
        if (!messagesContainer) return;

        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${messageData.sender === 'me' ? 'sent' : 'received'}`;
        
        const time = new Date(messageData.time);
        const timeString = time.toLocaleTimeString('pt-BR', { 
            hour: '2-digit', 
            minute: '2-digit' 
        });

        messageDiv.innerHTML = `
            <div>${messageData.text}</div>
            <div class="message-time">${timeString}</div>
        `;

        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    loadChatMessages(userName) {
        const messagesContainer = document.getElementById('chat-messages');
        if (!messagesContainer) return;

        messagesContainer.innerHTML = '';

        if (this.conversations[userName] && this.conversations[userName].messages) {
            this.conversations[userName].messages.forEach(message => {
                this.addMessageToChat(message);
            });
        }
    }

    simulateResponse() {
        if (!this.currentChatUser) return;

        const responses = [
            "Oi! Como você está?",
            "Que legal! 😊",
            "Interessante, me conte mais!",
            "Entendi! E você, o que acha?",
            "Muito bom saber disso!",
            "Haha, verdade! 😄",
            "Concordo totalmente!",
            "Nossa, não sabia!",
            "Que incrível!",
            "Boa! 👍"
        ];

        // Mostrar indicador de digitação
        const typingIndicator = document.getElementById('typing-indicator');
        const typingUserName = document.getElementById('typing-user-name');
        
        if (typingUserName) typingUserName.textContent = this.currentChatUser.name;
        if (typingIndicator) typingIndicator.classList.remove('hidden');

        setTimeout(() => {
            if (typingIndicator) typingIndicator.classList.add('hidden');
            
            const responseMessage = {
                text: responses[Math.floor(Math.random() * responses.length)],
                time: new Date().toISOString(),
                sender: 'other'
            };

            this.addMessageToChat(responseMessage);
            
            // Salvar resposta
            if (this.conversations[this.currentChatUser.name]) {
                this.conversations[this.currentChatUser.name].messages.push(responseMessage);
                this.conversations[this.currentChatUser.name].lastMessage = responseMessage.text;
                this.conversations[this.currentChatUser.name].lastMessageTime = responseMessage.time;
                
                this.saveConversations();
                this.renderConversations();
            }
        }, 1000 + Math.random() * 2000);
    }

    setupChatInput() {
        const input = document.getElementById('chat-input');
        if (!input) return;
        
        input.addEventListener('input', () => {
            this.updateSendButton();
            this.autoResizeTextarea();
        });
    }

    updateSendButton() {
        const input = document.getElementById('chat-input');
        const sendBtn = document.getElementById('chat-send-btn');
        
        if (!input || !sendBtn) return;
        
        sendBtn.disabled = !input.value.trim();
    }

    autoResizeTextarea() {
        const textarea = document.getElementById('chat-input');
        if (!textarea) return;

        textarea.style.height = 'auto';
        textarea.style.height = Math.min(textarea.scrollHeight, 100) + 'px';
    }

    renderConversations() {
        const container = document.getElementById('conversations-list');
        if (!container) {
            console.log('❌ Container conversations-list não encontrado');
            return;
        }

        container.innerHTML = '';

        const conversationsList = Object.values(this.conversations).sort((a, b) => 
            new Date(b.lastMessageTime) - new Date(a.lastMessageTime)
        );

        if (conversationsList.length === 0) {
            container.innerHTML = `
                <div class="text-center py-12">
                    <i class="fas fa-comments text-4xl text-gray-600 mb-4"></i>
                    <p class="text-gray-400">Nenhuma conversa ainda</p>
                    <p class="text-sm text-gray-500 mt-2">Vá para Amigos e comece uma conversa!</p>
                </div>
            `;
            return;
        }

        conversationsList.forEach(conversation => {
            const time = new Date(conversation.lastMessageTime);
            const timeString = this.formatTime(time);
            
            const conversationDiv = document.createElement('div');
            conversationDiv.className = `conversation-item ${conversation.unreadCount > 0 ? 'unread' : ''}`;
            conversationDiv.onclick = () => this.openChat(conversation.name, conversation.avatar, conversation.status);

            conversationDiv.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3 flex-1">
                        <div class="w-12 h-12 rounded-full bg-gray-600 border-2 border-gray-400 overflow-hidden flex-shrink-0">
                            ${conversation.avatar ? 
                                `<img src="${conversation.avatar}" class="w-full h-full object-cover" alt="Avatar">` :
                                `<div class="w-full h-full flex items-center justify-center">
                                    <i class="fas fa-user text-gray-300"></i>
                                </div>`
                            }
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="font-semibold text-white truncate">${conversation.name}</h4>
                            <p class="conversation-preview">${conversation.lastMessage || 'Iniciar conversa'}</p>
                        </div>
                    </div>
                    <div class="flex flex-col items-end gap-1">
                        <span class="conversation-time">${timeString}</span>
                        ${conversation.unreadCount > 0 ? 
                            `<div class="unread-badge">${conversation.unreadCount}</div>` : 
                            ''
                        }
                        <div class="w-2 h-2 rounded-full ${conversation.status === 'online' ? 'bg-green-500' : 'bg-gray-500'}"></div>
                    </div>
                </div>
            `;

            container.appendChild(conversationDiv);
        });
    }

    formatTime(date) {
        const now = new Date();
        const diffMs = now - date;
        const diffHours = diffMs / (1000 * 60 * 60);
        const diffDays = diffMs / (1000 * 60 * 60 * 24);

        if (diffHours < 1) {
            return 'Agora';
        } else if (diffHours < 24) {
            return date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        } else if (diffDays < 7) {
            return date.toLocaleDateString('pt-BR', { weekday: 'short' });
        } else {
            return date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
        }
    }

    filterConversations(query) {
        const items = document.querySelectorAll('.conversation-item');
        items.forEach(item => {
            const nameElement = item.querySelector('h4');
            const messageElement = item.querySelector('.conversation-preview');
            
            if (nameElement && messageElement) {
                const name = nameElement.textContent.toLowerCase();
                const message = messageElement.textContent.toLowerCase();
                const matches = name.includes(query.toLowerCase()) || message.includes(query.toLowerCase());
                item.style.display = matches ? 'block' : 'none';
            }
        });
    }

    loadConversations() {
        try {
            const saved = localStorage.getItem('7chat_conversations');
            return saved ? JSON.parse(saved) : {};
        } catch (error) {
            console.log('Erro ao carregar conversas:', error);
            return {};
        }
    }

    saveConversations() {
        try {
            localStorage.setItem('7chat_conversations', JSON.stringify(this.conversations));
        } catch (error) {
            console.log('Erro ao salvar conversas:', error);
        }
    }
}

// ==================== RESTO DO CÓDIGO ORIGINAL ====================

// Variável global para o gerenciador de conversas
// let conversationManager = null; // Já declarado anteriormente

// Função global para iniciar chat
function startChat(userName, userAvatar = null, userStatus = 'online') {
    console.log(`🚀 Iniciando conversa com: ${userName}`);
    
    if (!conversationManager) {
        conversationManager = new ConversationManager();
        conversationManager.init();
    }
    
    // Aguardar inicialização se necessário
    if (!conversationManager.isInitialized) {
        setTimeout(() => startChat(userName, userAvatar, userStatus), 1000);
        return;
    }
    
    conversationManager.openChat(userName, userAvatar, userStatus);
}

// Inicialização
document.addEventListener('DOMContentLoaded', function() {
    console.log('📱 7Chat carregado!');
    
    // Aguardar que tudo carregue
    setTimeout(() => {        try {
            if (!window.conversationManager) {
                window.conversationManager = new ConversationManager();
                conversationManager.init();
            }
        } catch (error) {
            console.log('❌ Erro na inicialização:', error);
        }
    }, 2000);

    // --- FUNÇÕES PRINCIPAIS ---
    function main() {
        console.log('🚀 Inicializando aplicação...');
        
        try {
            console.log('✅ Firebase já inicializado com sucesso');
            
            // DEBUG - Verificar elementos do DOM
            console.log('🔧 Debug - Elementos encontrados:');            console.log('Login form:', document.getElementById('login-form'));
            console.log('Guest login btn:', document.getElementById('main-guest-login-btn'));
            console.log('Auth object:', auth);

            bindUI();
            if (typeof handleAuthChange === 'function') {
    handleAuthChange(user);
} else {
    console.warn('handleAuthChange não está definida ainda');
}
            
            console.log('✅ Event listeners configurados');
            
        } catch (error) {
            console.error('❌ Erro ao inicializar aplicação:', error);
            showNotification('Erro de conexão. Tente recarregar a página.', 'error');
        }
    }    function bindUI() {
        console.log('🔧 Configurando event listeners...');
        
        // Login
        const loginForm = document.getElementById('login-form');
        if (loginForm) {
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('email-input').value;
                const password = document.getElementById('password-input').value;
                handleLogin(e);
            });
            console.log('✅ Formulário de login configurado');
        }

        // Login como convidado
        const guestLoginBtn = document.getElementById('main-guest-login-btn');
        if (guestLoginBtn) {
            guestLoginBtn.addEventListener('click', function(e) {
                e.preventDefault();
                loginAsGuest();
            });
            console.log('✅ Botão de convidado configurado');
        }

        // Navegação
        const navFriends = document.getElementById('nav-friends');
        const navRooms = document.getElementById('nav-rooms');
        const navSettings = document.getElementById('nav-settings');
        const appContainer = document.getElementById('app-container');
        const friendsScreen = document.getElementById('friends-screen');

        navFriends?.addEventListener('click', (e) => {
            e.preventDefault();
            friendsScreen.classList.remove('hidden');
            appContainer.classList.add('hidden');
            updateNav(navFriends);
        });

        navRooms?.addEventListener('click', (e) => {
            e.preventDefault();
            friendsScreen.classList.add('hidden');
            appContainer.classList.remove('hidden');
            updateNav(navRooms);
        });

        navSettings?.addEventListener('click', (e) => {
            e.preventDefault();
            updateSettingsUserInfo();
            document.getElementById('settings-modal').classList.remove('hidden');
        });

        // Botão de teste
        document.addEventListener('click', (e) => {
            if (e.target.id === 'test-btn') {
                showNotification('Aplicativo funcionando perfeitamente!', 'info');
            }
        });

        // Inicializar todas as funções de perfil APÓS configurar os event listeners básicos
        try {
            // initializeProfile(); // Comentar esta linha temporariamente
            if (typeof initializeEditName === 'function') {
    initializeEditName();
} else {
    console.warn('initializeEditName não está definida ainda');
}
            initializeEditStatus();
            initializeNameEffects();
            initializeNameBanners();
            initializeProfileDetail();
            console.log('✅ Todas as funções de perfil inicializadas com sucesso');
        } catch (error) {
            console.error('❌ Erro ao inicializar funções de perfil:', error);
        }
    }// INICIALIZAR APLICAÇÃO
    main();
});

// Função placeholder para search
function initializeSearch() {
    console.log('🔍 Sistema de busca inicializado');
    // TODO: Implementar sistema de busca
}

// Função placeholder para fotos de usuário
function initializeUserPhoto() {
    console.log('📸 Sistema de fotos de usuário inicializado');
    // TODO: Implementar sistema de fotos
}
</script>
    function renderAllConversations() {
        const conversationsList = document.getElementById('all-conversations-list');
        const emptyState = document.getElementById('empty-state');
        
        // Por enquanto, não há conversas reais
        // Quando implementarmos o Firebase, aqui carregaremos as conversas reais
        const conversations = []; // Array vazio - será preenchido com dados reais
        
        if (conversations.length === 0) {
            conversationsList.innerHTML = '';
            emptyState.classList.remove('hidden');
        } else {
            emptyState.classList.add('hidden');
            
            // Quando houver conversas, renderizar assim:
            conversationsList.innerHTML = conversations.map(conv => `
                <div class="flex items-center p-3 bg-gray-800 rounded-lg hover:bg-gray-700 cursor-pointer transition-colors" data-conversation-id="${conv.id}">
                    <div class="relative">
                        <div class="w-12 h-12 ${conv.type === 'room' ? 'bg-purple-500' : 'bg-blue-500'} rounded-full flex items-center justify-center">
                            <span class="text-white font-semibold text-sm">${conv.avatar}</span>
                        </div>
                        ${conv.online ? '<div class="absolute -bottom-0.5 -right-0.5 w-4 h-4 bg-green-500 border-2 border-gray-800 rounded-full"></div>' : ''}
                    </div>
                    <div class="flex-1 ml-3 min-w-0">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <p class="text-white font-medium truncate">${conv.name}</p>
                                ${conv.type === 'room' ? `<span class="text-gray-500 text-xs">${conv.members} membros</span>` : ''}
                            </div>
                            <span class="text-gray-400 text-xs">${conv.timestamp}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <p class="text-gray-400 text-sm truncate">${conv.lastMessage}</p>
                            ${conv.unread > 0 ? `<span class="bg-blue-500 text-white text-xs rounded-full px-2 py-0.5 ml-2">${conv.unread}</span>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }    }

    // Clique nas conversas
    function initializeConversationClicks() {
        document.addEventListener('click', (e) => {
            const conversationItem = e.target.closest('[data-conversation-id]');
            
            if (conversationItem) {
                const conversationId = conversationItem.dataset.conversationId;
                showNotification(`Abrindo conversa: ${conversationId}`, 'info');
                // Aqui você pode abrir a tela de chat
            }
        });
    }    // Funcionalidade de foto do usuário - Sistema avançado de redimensionamento
    
    // Função para redimensionar imagem
    function resizeImage(file, maxWidth = 400, quality = 0.8) {
        return new Promise((resolve) => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = function() {
                // Calcular dimensões mantendo proporção
                let { width, height } = img;
                
                if (width > height) {
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }
                } else {
                    if (height > maxWidth) {
                        width = (width * maxWidth) / height;
                        height = maxWidth;
                    }
                }
                
                // Redimensionar canvas
                canvas.width = width;
                canvas.height = height;
                
                // Desenhar imagem redimensionada
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, width, height);
                ctx.drawImage(img, 0, 0, width, height);
                
                // Converter para base64 otimizado
                const resizedDataURL = canvas.toDataURL('image/jpeg', quality);
                resolve(resizedDataURL);
            };
            
            // Ler arquivo como data URL
            const reader = new FileReader();
            reader.onload = (e) => {
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });
    }

    // Função para validar tamanho do arquivo
    function validateImageSize(dataURL) {
        // Calcular tamanho aproximado em bytes
        const sizeInBytes = (dataURL.length * 3) / 4;
        const maxSizeInBytes = 900000; // 900KB para deixar margem de segurança
        
        return sizeInBytes <= maxSizeInBytes;
    }

    // Função para calcular e mostrar informações da imagem (para debug)
    function getImageInfo(dataURL) {
        const sizeInBytes = (dataURL.length * 3) / 4;
        const sizeInKB = Math.round(sizeInBytes / 1024);
        console.log(`📊 Tamanho da imagem: ${sizeInKB}KB (${sizeInBytes} bytes)`);
        return { sizeInBytes, sizeInKB };
    }

    // Função para comprimir ainda mais se necessário
    async function compressImageAggressively(file) {
        try {
            // Tentar diferentes configurações até conseguir um tamanho aceitável
            const configs = [
                { width: 300, quality: 0.7 },
                { width: 250, quality: 0.6 },
                { width: 200, quality: 0.5 },
                { width: 150, quality: 0.4 },
                { width: 100, quality: 0.3 }
            ];
            
            for (const config of configs) {
                const compressed = await resizeImage(file, config.width, config.quality);
                if (validateImageSize(compressed)) {
                    console.log(`✅ Imagem comprimida: ${config.width}px, qualidade ${config.quality}`);
                    return compressed;
                }
            }
            
            throw new Error('Não foi possível comprimir a imagem adequadamente');
            
        } catch (error) {
            console.error('❌ Erro na compressão agressiva:', error);
            throw error;
        }
    }

    // Função auxiliar para mostrar preview da imagem (opcional)
    function previewImage(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = (e) => resolve(e.target.result);
            reader.readAsDataURL(file);
        });
    }

    // Função atualizada para salvar foto do usuário
    async function updateUserPhoto(file) {
        try {
            console.log('📸 Iniciando upload da foto...');
            
            // Verificar se o arquivo é uma imagem
            if (!file.type.startsWith('image/')) {
                throw new Error('Por favor, selecione apenas arquivos de imagem');
            }
            
            // Verificar tamanho original do arquivo (limite 10MB)
            if (file.size > 10 * 1024 * 1024) {
                throw new Error('Arquivo muito grande. Máximo 10MB');
            }
            
            // Mostrar loading
            const photoContainer = document.getElementById('settings-photo-container');
            const originalContent = photoContainer.innerHTML;
            photoContainer.innerHTML = `
                <div class="w-16 h-16 rounded-full bg-gray-600 border-2 border-gray-500 flex items-center justify-center">
                    <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"></div>
                </div>
            `;
            
            try {
                // Redimensionar imagem (tentativa 1: 400px, qualidade 0.8)
                let resizedImage = await resizeImage(file, 400, 0.8);
                
                // Se ainda estiver muito grande, reduzir mais
                if (!validateImageSize(resizedImage)) {
                    console.log('🔄 Imagem ainda grande, reduzindo mais...');
                    resizedImage = await resizeImage(file, 300, 0.6);
                }
                
                // Se ainda estiver muito grande, reduzir drasticamente
                if (!validateImageSize(resizedImage)) {
                    console.log('🔄 Reduzindo ainda mais...');
                    resizedImage = await resizeImage(file, 200, 0.4);
                }
                
                // Verificação final
                if (!validateImageSize(resizedImage)) {
                    throw new Error('Não foi possível reduzir a imagem o suficiente. Tente uma imagem menor.');
                }
                
                console.log('✅ Imagem redimensionada com sucesso');
                getImageInfo(resizedImage);
                
                // Atualizar interfaces primeiro
                const headerPic = document.getElementById('user-profile-pic');
                const headerIcon = document.getElementById('user-profile-icon');
                const profileModalPic = document.getElementById('profile-modal-pic');
                const profileModalIcon = document.getElementById('profile-modal-icon');
                const settingsPic = document.getElementById('settings-user-pic');
                const settingsIcon = document.getElementById('settings-user-icon');
                
                // Atualizar foto do header
                if (headerPic && headerIcon) {
                    headerPic.src = resizedImage;
                    headerPic.classList.remove('hidden');
                    headerIcon.classList.add('hidden');
                }
                
                // Atualizar foto do modal de perfil
                if (profileModalPic && profileModalIcon) {
                    profileModalPic.src = resizedImage;
                    profileModalPic.classList.remove('hidden');
                    profileModalIcon.classList.add('hidden');
                }
                
                // Atualizar foto das configurações
                if (settingsPic && settingsIcon) {
                    settingsPic.src = resizedImage;
                    settingsPic.classList.remove('hidden');
                    settingsIcon.classList.add('hidden');
                }
                
                // Restaurar container das configurações
                photoContainer.innerHTML = originalContent;
                  // Salvar no Firestore
                await db.collection('users').doc(currentUser.uid).update({
                    photoURL: resizedImage,
                    updatedAt: new Date()
                });
                
                // Atualizar currentUser
                currentUser.photoURL = resizedImage;
                updateUserInterface();
                
                console.log('✅ Foto salva com sucesso!');
                showNotification('Foto atualizada com sucesso!', 'success');
                
                // Atualizar tela de perfil detalhado se estiver aberta
                updateProfileDetail();
                
            } catch (error) {
                // Restaurar conteúdo original em caso de erro
                photoContainer.innerHTML = originalContent;
                throw error;
            }
            
        } catch (error) {
            console.error('❌ Erro ao salvar foto:', error);
            showNotification(error.message || 'Erro ao salvar foto', 'error');        }
    }

    // Event listener atualizado para seleção de foto (ID alternativo)
    const photoInput = document.getElementById('photo-input');
    if (photoInput) {
        photoInput.addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (file) {
                await updateUserPhoto(file);
                // Limpar input para permitir selecionar a mesma foto novamente
                this.value = '';
            }
        });
    }

    // Função para inicializar configurações
        function initializeSettings() {
            const settingsModal = document.getElementById('settings-modal');
            const closeSettingsBtn = document.getElementById('close-settings-btn');
            const editNameOption = document.getElementById('settings-edit-name-option');
            const editStatusOption = document.getElementById('settings-edit-status-option');            const nameEffectsOption = document.getElementById('settings-name-effects-option');
            const logoutOption = document.getElementById('logout-option');
              // DEBUG: Capturar todos os cliques no modal de configurações
            settingsModal?.addEventListener('click', function(e) {
                console.log('🎯 CLIQUE no modal de configurações:', {
                    target: e.target,
                    targetId: e.target.id,
                    targetClass: e.target.className,
                    targetTagName: e.target.tagName
                });
                
                // Ignorar cliques na foto e seus elementos filhos
                if (e.target.closest('#settings-photo-container')) {
                    console.log('🚫 Clique na foto ignorado pelo listener geral');
                    return;
                }
                
                // Fechar modal se clicar fora
                if (e.target === settingsModal) {
                    settingsModal.classList.add('hidden');
                }
            });
            
            // Fechar modal de configurações
            closeSettingsBtn?.addEventListener('click', () => {
                settingsModal.classList.add('hidden');
            });
              // Abrir modal de edição de nome
            editNameOption?.addEventListener('click', function(e) {
                console.log('📝 Clique em editar nome');
                settingsModal.classList.add('hidden');
                openEditNameModal();
            });
            
            // Abrir modal de edição de status
            editStatusOption?.addEventListener('click', function(e) {
                console.log('💬 Clique em editar status');
                settingsModal.classList.add('hidden');
                openEditStatusModal();
            });              // Logout
            logoutOption?.addEventListener('click', async () => {                
                try {
                    // Limpar todos os listeners no logout
                    if (window.notificationsUnsubscribe) {
                        window.notificationsUnsubscribe();
                        window.notificationsUnsubscribe = null;
                    }
                    
                    if (window.friendsUnsubscribe) {
                        window.friendsUnsubscribe();
                        window.friendsUnsubscribe = null;
                    }
                    
                    // Limpar conversas privadas
                    if (conversationManager) {
                        conversationManager.clearConversations();
                    }
                    
                    // Limpar dados locais
                    friendRequests = [];
                    updateNotificationsBadge();
                    
                    await auth.signOut();
                    settingsModal.classList.add('hidden');
                    showNotification('Logout realizado com sucesso!', 'info');
                } catch (error) {
                    console.error('Erro ao fazer logout:', error);
                    showNotification('Erro ao fazer logout.', 'error');
                }
            });
        }        // Função updateSettingsUserInfo - VERSÃO CORRIGIDA V8
        async function updateSettingsUserInfo() {
            const user = auth.currentUser;
            if (!user) return;
            
            const settingsUserName = document.getElementById('settings-user-name');
            const settingsUserEmail = document.getElementById('settings-user-email');
            const settingsUserPic = document.getElementById('settings-user-pic');
            const settingsUserIcon = document.getElementById('settings-user-icon');
            const settingsDisplayName = document.getElementById('settings-display-name');
            const settingsDisplayStatus = document.getElementById('settings-display-status');
            
            try {
                // Usar sintaxe v8 do Firebase
                const userDocRef = db.collection('users').doc(user.uid);
                const userDoc = await userDocRef.get();
                
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    
                    // Nome
                    const displayName = userData?.username || user.displayName || 'Usuário';
                    if (settingsUserName) settingsUserName.textContent = displayName;
                    if (settingsDisplayName) settingsDisplayName.textContent = displayName;
                    
                    // Email
                    if (settingsUserEmail) {
                        settingsUserEmail.textContent = user.isAnonymous ? 'Sessão temporária' : (user.email || 'Sem email');
                    }
                    
                    // Status
                    if (settingsDisplayStatus) {
                        settingsDisplayStatus.textContent = userData?.status || 'Olá! Eu estou usando o 7Chat.';
                    }
                    
                    // Foto
                    if (userData?.photoURL) {
                        if (settingsUserPic) {
                            settingsUserPic.src = userData.photoURL;
                            settingsUserPic.classList.remove('hidden');
                        }
                        if (settingsUserIcon) {
                            settingsUserIcon.classList.add('hidden');
                        }
                    } else {
                        if (settingsUserPic) {
                            settingsUserPic.classList.add('hidden');
                        }
                        if (settingsUserIcon) {
                            settingsUserIcon.classList.remove('hidden');
                        }
                    }
                    
                    // NOVO: Carregar efeito do nome
                    if (userData?.nameEffect) {
                        applyNameEffectToInterface(userData.nameEffect);
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar dados do usuário:', error);
            }
        }
          // Carregar dados do usuário após login - VERSÃO CORRIGIDA        
        async function loadUserDataOnLogin() {            
            try {
                console.log('👤 Carregando dados completos do usuário...');
                
                // Testar conexão com Firebase primeiro
                await testFirebaseConnection();
                
                const user = auth.currentUser;
                if (!user) return;
                
                const userDoc = await db.collection('users').doc(user.uid).get();
                const userData = userDoc.data();
                
                // Carregar foto salva
                if (userData?.photoURL) {
                    const headerPic = document.getElementById('user-profile-pic');
                    const headerIcon = document.getElementById('user-profile-icon');
                    const profileModalPic = document.getElementById('profile-modal-pic');
                    const profileModalIcon = document.getElementById('profile-modal-icon');
                    
                    headerPic.src = userData.photoURL;
                    headerPic.classList.remove('hidden');
                    headerIcon.classList.add('hidden');
                    
                    profileModalPic.src = userData.photoURL;
                    profileModalPic.classList.remove('hidden');
                    profileModalIcon.classList.add('hidden');
                }
                
                // NOVO: Carregar efeito do nome
                if (userData?.nameEffect) {
                    applyNameEffectToInterface(userData.nameEffect);
                }
                  // NOVO: Configurar todos os listeners e carregar dados
                setTimeout(async () => {
                    console.log('🔄 Inicializando sistema completo...');
                    
                    // Carregar notificações
                    await loadNotifications();
                    
                    // Carregar lista de amigos
                    await loadFriendsList();
                    
                    // Configurar listeners em tempo real
                    setupNotificationsListener();
                    setupFriendsListener();
                    
                    // Inicializar sistema de conversas
                    if (!conversationManager) {
                        console.log('🔄 Inicializando sistema de conversas...');
                        conversationManager = new ConversationManager();
                        conversationManager.init();
                    }
                    
                    console.log('✅ Sistema completo inicializado');
                }, 1500);
                
            } catch (error) {
                console.error('❌ Erro ao carregar dados do usuário:', error);
            }
        }
        
        async function handleLogin(e) {
        e.preventDefault();
        console.log('🔄 Tentativa de login iniciada...');
        
        try {
            const email = document.getElementById('email-input').value;
            const password = document.getElementById('password-input').value;
            
            console.log('📧 Email:', email);
            console.log('🔑 Senha fornecida:', password ? 'Sim' : 'Não');
            
            const result = await auth.signInWithEmailAndPassword(email, password);
            console.log('✅ Login realizado com sucesso:', result.user.uid);
            
        } catch (err) {
            console.error('❌ Erro no login:', err);
            showNotification("Falha no login: " + err.message, "error");        }
    }    
    async function handleAuthChange(user) {
        const bottomNav = document.getElementById('bottom-nav');
        
        if (user) {
            currentUser = user;
            console.log('✅ Usuário logado:', user.uid);
              // Criar perfil se não existir
            let userSnap = await db.collection('users').doc(user.uid).get();
            if (!userSnap.exists) {
                await createUserProfile(user);
            }
              // Mostrar interface principal
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('app-container').classList.remove('hidden');
              // Mostrar navegação inferior
            bottomNav.classList.remove('hidden');
            
            // Carregar dados do usuário após login
            loadUserDataOnLogin();
            
            // Carregar conversas do usuário
            setTimeout(() => {
                renderAllConversations();
            }, 500);
              } else {
            console.log('❌ Usuário não logado');
            currentUser = null;
            
            // Mostrar tela de login
            document.getElementById('app-container').classList.add('hidden');
            document.getElementById('friends-screen').classList.add('hidden');
            document.getElementById('guest-container').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
            
            // Esconder navegação inferior
            bottomNav.classList.add('hidden');
        }
    }async function createUserProfile(user) {
        const baseProfile = { 
            uid: user.uid, 
            friends: [], 
            friendRequests: [],
            status: 'Olá! Eu estou usando o 7Chat...'
        };

        if (user.isAnonymous) {
            const guestName = await showCustomPrompt("Bem-vindo(a)!", "Para entrar, por favor, digite seu nome de convidado.");            if (!guestName) { 
                await auth.signOut(); 
                throw new Error("Guest name not provided."); 
            }Object.assign(baseProfile, {
                username: `Convidado: ${guestName.trim()}`,
                isGuest: true,
                photoURL: null
            });
        } else {
            const username = user.email.split('@')[0];
            Object.assign(baseProfile, {
                username,
                email: user.email,
                isGuest: false,
                photoURL: null
            });
        }
        
        await db.collection('users').doc(user.uid).set(baseProfile);
        console.log('✅ Perfil de usuário criado');
    }    // Corrigir o event listener que está causando o erro "Cannot read properties of null"
    function initializeProfile() {
        const userProfileBtn = document.getElementById('user-profile-btn');
        const profileModal = document.getElementById('profile-modal');
        const closeProfileBtn = document.getElementById('close-profile-btn');
        const editProfileBtn = document.getElementById('edit-profile-btn');
        const changePhotoFromProfileBtn = document.getElementById('change-photo-from-profile-btn');
        
        // Verificar se os elementos existem antes de adicionar event listeners
        if (userProfileBtn && profileModal) {
            // Abrir modal de perfil
            userProfileBtn.addEventListener('click', () => {
                updateProfileModal();
                profileModal.classList.remove('hidden');
            });
        }
        
        if (closeProfileBtn && profileModal) {
            // Fechar modal
            closeProfileBtn.addEventListener('click', () => {
                profileModal.classList.add('hidden');
            });
        }
        
        if (profileModal) {
            // Fechar clicando fora
            profileModal.addEventListener('click', (e) => {
                if (e.target === profileModal) {
                    profileModal.classList.add('hidden');
                }
            });
        }
        
        if (editProfileBtn && profileModal) {
            // Botão editar perfil
            editProfileBtn.addEventListener('click', () => {
                profileModal.classList.add('hidden');
                openEditNameModal();
            });
        }
        
        // Verificar se o botão trocar foto existe antes de adicionar listener
        if (changePhotoFromProfileBtn && profileModal) {
            // Botão trocar foto
            changePhotoFromProfileBtn.addEventListener('click', () => {
                profileModal.classList.add('hidden');
                const photoUploadInput = document.getElementById('photo-upload-input');
                if (photoUploadInput) {
                    photoUploadInput.click();
                }
            });
        }
    }

    // Nova função para abrir modal de edição de status
    function openEditStatusModal() {
        const editStatusModal = document.getElementById('edit-status-modal');
        const editStatusInput = document.getElementById('edit-status-input');
        const settingsDisplayStatus = document.getElementById('settings-display-status');
        
        // Preencher com status atual
        editStatusInput.value = settingsDisplayStatus.textContent;
        editStatusModal.classList.remove('hidden');
        setTimeout(() => editStatusInput.focus(), 100);
    }
    // Abrir modal de edição de nome
    function openEditNameModal() {
        const editNameModal = document.getElementById('edit-name-modal');
        const editNameInput = document.getElementById('edit-name-input');
        const settingsDisplayName = document.getElementById('settings-display-name');
        
        // Preencher com nome atual
        editNameInput.value = settingsDisplayName.textContent;
        editNameModal.classList.remove('hidden');
        setTimeout(() => editNameInput.focus(), 100);
    }    // Função updateProfileModal - VERSÃO CORRIGIDA V8
    async function updateProfileModal() {
        const user = auth.currentUser;
        if (!user) return;
        
        const profileModalName = document.getElementById('profile-modal-name');
        const profileModalEmail = document.getElementById('profile-modal-email');
        const profileModalPic = document.getElementById('profile-modal-pic');
        const profileModalIcon = document.getElementById('profile-modal-icon');
        
        try {
            // Usar sintaxe v8 do Firebase
            const userDocRef = db.collection('users').doc(user.uid);
            const userDoc = await userDocRef.get();
            
            if (userDoc.exists) {
                const userData = userDoc.data();
                
                // Nome
                if (user.isAnonymous) {
                    profileModalName.textContent = userData?.username || 'Usuário Convidado';
                    profileModalEmail.textContent = 'Sessão temporária';
                } else {
                    profileModalName.textContent = userData?.username || user.displayName || 'Usuário';
                    profileModalEmail.textContent = user.email || 'Sem email';
                }
                
                // Foto
                if (userData?.photoURL) {
                    profileModalPic.src = userData.photoURL;
                    profileModalPic.classList.remove('hidden');
                    profileModalIcon.classList.add('hidden');
                } else {
                    profileModalPic.classList.add('hidden');
                    profileModalIcon.classList.remove('hidden');
                }
            }
        } catch (error) {
            console.error('Erro ao carregar dados do perfil:', error);
        }
    }

    // Inicializar tela de perfil detalhado
    function initializeProfileDetail() {
        const settingsUserProfile = document.getElementById('settings-user-profile');
        const profileDetailModal = document.getElementById('user-profile-detail-modal');
        const backBtn = document.getElementById('back-from-profile-detail-btn');
        const editPhotoBtn = document.getElementById('edit-photo-btn');
        const editNameSection = document.getElementById('edit-name-section');
        const photoUploadInput = document.getElementById('photo-upload-input');
        
        // Abrir tela de perfil detalhado
        settingsUserProfile?.addEventListener('click', () => {
            document.getElementById('settings-modal').classList.add('hidden');
            updateProfileDetail();
            profileDetailModal.classList.remove('hidden');
        });
        
        // Voltar para configurações
        backBtn?.addEventListener('click', () => {
            profileDetailModal.classList.add('hidden');
            document.getElementById('settings-modal').classList.remove('hidden');
        });
        
        // Editar foto
        editPhotoBtn?.addEventListener('click', () => {
            photoUploadInput.click();
        });
        
        // Editar nome
        editNameSection?.addEventListener('click', () => {
            profileDetailModal.classList.add('hidden');
            openEditNameModal();
        });
        
        // Fechar clicando fora
        profileDetailModal?.addEventListener('click', (e) => {
            if (e.target === profileDetailModal) {
                profileDetailModal.classList.add('hidden');
                document.getElementById('settings-modal').classList.remove('hidden');
            }
        });
    }    // Função updateProfileDetail - VERSÃO CORRIGIDA V8
    async function updateProfileDetail() {
        const user = auth.currentUser;
        if (!user) return;
        
        const nameElement = document.getElementById('profile-detail-name');
        const statusElement = document.getElementById('profile-detail-status');
        const phoneElement = document.getElementById('profile-detail-phone');
        const picElement = document.getElementById('profile-detail-pic');
        const iconElement = document.getElementById('profile-detail-icon');
        
        try {
            // Usar sintaxe v8 do Firebase
            const userDocRef = db.collection('users').doc(user.uid);
            const userDoc = await userDocRef.get();
            
            if (userDoc.exists) {
                const userData = userDoc.data();
                
                // Nome
                if (user.isAnonymous) {
                    nameElement.textContent = userData?.username || 'Usuário Convidado';
                } else {
                    nameElement.textContent = userData?.username || user.displayName || 'Usuário';
                }
                
                // Status/Recado
                statusElement.textContent = userData?.status || 'Olá! Eu estou usando o 7Chat.';
                
                // Telefone
                phoneElement.textContent = userData?.phone || '+55 (11) 99999-9999';
                
                // Foto
                if (userData?.photoURL) {
                    picElement.src = userData.photoURL;
                    picElement.classList.remove('hidden');
                    iconElement.classList.add('hidden');
                } else {
                    picElement.classList.add('hidden');
                    iconElement.classList.remove('hidden');
                }
            }
        } catch (error) {
            console.error('Erro ao carregar dados do perfil detalhado:', error);
        }
    }

    // NOVAS FUNÇÕES CORRIGIDAS - Substituindo as funções existentes
    function initializeEditName() {
        const editNameModal = document.getElementById('edit-name-modal');
        const editNameInput = document.getElementById('edit-name-input');
        const saveNameBtn = document.getElementById('save-name-btn');
        const cancelEditNameBtn = document.getElementById('cancel-edit-name-btn');
        
        // Salvar nome
        saveNameBtn?.addEventListener('click', async () => {
            const newName = editNameInput.value.trim();
            if (newName) {
                try {
                    const user = auth.currentUser;                    if (user) {
                        await db.collection('users').doc(user.uid).update({
                            username: newName
                        });
                        
                        // Atualizar na interface
                        updateUserNameInInterface(newName);
                        editNameModal.classList.add('hidden');
                        
                        // Voltar para configurações
                        updateSettingsUserInfo();
                        document.getElementById('settings-modal').classList.remove('hidden');
                        
                        showNotification('Nome atualizado com sucesso!', 'info');
                    }
                } catch (error) {
                    console.error('Erro ao salvar nome:', error);
                    showNotification('Erro ao salvar nome.', 'error');
                }
            }
        });
        
        // Cancelar edição - CORRIGIDO para voltar às configurações
        cancelEditNameBtn?.addEventListener('click', () => {
            editNameModal.classList.add('hidden');
            // Voltar para configurações ao invés de sair
            updateSettingsUserInfo();
            document.getElementById('settings-modal').classList.remove('hidden');
        });
        
        // Fechar clicando fora
        editNameModal?.addEventListener('click', (e) => {
            if (e.target === editNameModal) {
                editNameModal.classList.add('hidden');
                updateSettingsUserInfo();
                document.getElementById('settings-modal').classList.remove('hidden');
            }
        });
    }

    function initializeEditStatus() {
        const editStatusModal = document.getElementById('edit-status-modal');
        const editStatusInput = document.getElementById('edit-status-input');
        const saveStatusBtn = document.getElementById('save-status-btn');
        const cancelEditStatusBtn = document.getElementById('cancel-edit-status-btn');
        
        // Salvar status
        saveStatusBtn?.addEventListener('click', async () => {
            const newStatus = editStatusInput.value.trim();
            if (newStatus) {
                try {
                    const user = auth.currentUser;                    if (user) {
                        await db.collection('users').doc(user.uid).update({
                            status: newStatus
                        });
                        
                        // Atualizar na interface
                        updateUserStatusInInterface(newStatus);
                        editStatusModal.classList.add('hidden');
                        
                        // Voltar para configurações
                        updateSettingsUserInfo();
                        document.getElementById('settings-modal').classList.remove('hidden');
                        
                        showNotification('Status atualizado com sucesso!', 'info');
                    }
                } catch (error) {
                    console.error('Erro ao salvar status:', error);
                    showNotification('Erro ao salvar status.', 'error');
                }
            }
        });
        
        // Cancelar edição - CORRIGIDO para voltar às configurações
        cancelEditStatusBtn?.addEventListener('click', () => {
            editStatusModal.classList.add('hidden');
            // Voltar para configurações ao invés de sair
            updateSettingsUserInfo();
            document.getElementById('settings-modal').classList.remove('hidden');
        });
        
        // Fechar clicando fora
        editStatusModal?.addEventListener('click', (e) => {
            if (e.target === editStatusModal) {
                editStatusModal.classList.add('hidden');
                updateSettingsUserInfo();
                document.getElementById('settings-modal').classList.remove('hidden');
            }
        });
    }

    // NOVA FUNÇÃO - Inicializar efeitos do nome
    function initializeNameEffects() {
        const nameEffectsModal = document.getElementById('name-effects-modal');
        const namePreview = document.getElementById('name-preview');
        const saveEffectsBtn = document.getElementById('save-name-effects-btn');
        const cancelEffectsBtn = document.getElementById('cancel-name-effects-btn');
        const effectOptions = document.querySelectorAll('.effect-option');
        
        let selectedEffect = 'none';
        let currentUserName = 'Seu Nome';
          // Abrir modal de efeitos
        const nameEffectsOption = document.getElementById('settings-name-effects-option');
        nameEffectsOption?.addEventListener('click', function(e) {
            console.log('✨ Clique em efeitos de nome');
            document.getElementById('settings-modal').classList.add('hidden');
            
            // Carregar nome atual
            const currentName = document.getElementById('settings-user-name').textContent;
            currentUserName = currentName;
            namePreview.textContent = currentName;
            
            // Carregar efeito atual do usuário
            loadUserCurrentEffect();
            
            nameEffectsModal.classList.remove('hidden');
        });
        
        // Selecionar efeito
        effectOptions.forEach(option => {
            option.addEventListener('click', () => {
                // Remover seleção anterior
                document.querySelectorAll('.effect-radio').forEach(radio => {
                    radio.classList.remove('selected');
                });
                
                // Adicionar seleção na nova opção
                const radio = option.querySelector('.effect-radio');
                radio.classList.add('selected');
                
                // Atualizar preview
                selectedEffect = option.dataset.effect;
                updateNamePreview(selectedEffect);
            });
        });
        
        // Salvar efeito
        saveEffectsBtn?.addEventListener('click', async () => {
            try {
                const user = auth.currentUser;                if (user) {
                    await db.collection('users').doc(user.uid).update({
                        nameEffect: selectedEffect
                    });
                    
                    // Aplicar efeito em toda a interface
                    applyNameEffectToInterface(selectedEffect);
                    
                    nameEffectsModal.classList.add('hidden');
                    updateSettingsUserInfo();
                    document.getElementById('settings-modal').classList.remove('hidden');
                    
                    showNotification('Efeito aplicado com sucesso!', 'info');
                }
            } catch (error) {
                console.error('Erro ao salvar efeito:', error);
                showNotification('Erro ao aplicar efeito.', 'error');
            }
        });
        
        // Cancelar
        cancelEffectsBtn?.addEventListener('click', () => {
            nameEffectsModal.classList.add('hidden');
            updateSettingsUserInfo();
            document.getElementById('settings-modal').classList.remove('hidden');
        });
        
        // Fechar clicando fora
        nameEffectsModal?.addEventListener('click', (e) => {
            if (e.target === nameEffectsModal) {
                nameEffectsModal.classList.add('hidden');
                updateSettingsUserInfo();
                document.getElementById('settings-modal').classList.remove('hidden');
            }
        });
        
        // Função para atualizar preview
        function updateNamePreview(effect) {
            // Remover todas as classes de efeito
            namePreview.className = 'text-2xl font-bold text-white';
            
            // Adicionar nova classe de efeito
            if (effect !== 'none') {
                namePreview.classList.add(`name-effect-${effect}`);
            }
        }
          // Função para carregar efeito atual do usuário - VERSÃO CORRIGIDA V8
        async function loadUserCurrentEffect() {
            try {
                if (!currentUser) {
                    console.log('❌ Usuário não logado');
                    return;
                }
                
                console.log('🎨 Carregando efeito atual do usuário...');
                
                // Usar sintaxe v8 do Firebase
                const userDocRef = db.collection('users').doc(currentUser.uid);
                const userDoc = await userDocRef.get();
                
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    const currentEffect = userData.nameEffect || 'none';
                    
                    console.log('✅ Efeito atual carregado:', currentEffect);
                    
                    // Limpar seleções anteriores
                    document.querySelectorAll('.effect-radio').forEach(radio => {
                        radio.classList.remove('selected');
                    });
                    
                    // Marcar o efeito atual como selecionado
                    const currentRadio = document.querySelector(`input[name="nameEffect"][value="${currentEffect}"]`);
                    if (currentRadio) {
                        currentRadio.checked = true;
                        currentRadio.closest('.effect-radio').classList.add('selected');
                    }
                    
                } else {
                    console.log('⚠️ Documento do usuário não encontrado');
                }
                
            } catch (error) {
                console.error('❌ Erro ao carregar efeito atual:', error);
            }
        }
    }    // Função para aplicar efeito de nome na interface
    function applyNameEffectToInterface(effect) {
        try {
            // Encontrar todos os elementos que mostram o nome do usuário
            const nameElements = document.querySelectorAll('[data-user-name], .user-display-name, #settings-user-name');
            
            nameElements.forEach(element => {
                // Remover classes de efeito existentes
                element.className = element.className.replace(/name-effect-\w+/g, '');
                
                // Adicionar novo efeito se não for 'none'
                if (effect && effect !== 'none') {
                    element.classList.add(`name-effect-${effect}`);
                }
            });
            
            console.log('✅ Efeito de nome aplicado:', effect);
            
        } catch (error) {
            console.error('❌ Erro ao aplicar efeito de nome:', error);
        }
    }

    // Função para atualizar nome na interface
    function updateUserNameInInterface(name) {
        const nameElements = [
            document.getElementById('settings-user-name'),
            document.getElementById('settings-display-name')
        ];
        
        nameElements.forEach(element => {
            if (element) {
                element.textContent = name;
            }
        });
    }    // Função para atualizar status na interface
    function updateUserStatusInInterface(status) {
        const statusElements = [
            document.getElementById('settings-user-status'),
            document.getElementById('settings-display-status')
        ];
        
        statusElements.forEach(element => {
            if (element) {
                element.textContent = status;
            }
        });
    }

    // NOVA FUNÇÃO - Inicializar banners do nome
    function initializeNameBanners() {
        const nameBannersModal = document.getElementById('name-banners-modal');
        const bannerPreviewBg = document.getElementById('banner-preview-bg');
        const bannerPreviewName = document.getElementById('banner-preview-name');
        const saveBannersBtn = document.getElementById('save-name-banners-btn');
        const cancelBannersBtn = document.getElementById('cancel-name-banners-btn');
        const bannerOptions = document.querySelectorAll('.banner-option');
        
        let selectedBanner = 'none';
        let currentUserName = 'Seu Nome';
        
        // Abrir modal de banners
        const nameBannersOption = document.getElementById('settings-name-banners-option');
        nameBannersOption?.addEventListener('click', () => {
            document.getElementById('settings-modal').classList.add('hidden');
            
            // Carregar nome atual
            const currentName = document.getElementById('settings-user-name').textContent;
            currentUserName = currentName;
            bannerPreviewName.textContent = currentName;
            
            // Carregar banner atual do usuário
            loadUserCurrentBanner();
            
            nameBannersModal.classList.remove('hidden');
        });
        
        // Selecionar banner
        bannerOptions.forEach(option => {
            option.addEventListener('click', () => {
                // Remover seleção anterior
                document.querySelectorAll('.banner-radio').forEach(radio => {
                    radio.classList.remove('selected');
                });
                
                // Adicionar seleção na nova opção
                const radio = option.querySelector('.banner-radio');
                radio.classList.add('selected');
                
                // Atualizar preview
                selectedBanner = option.dataset.banner;
                updateBannerPreview(selectedBanner);
            });
        });
        
        // Salvar banner
        saveBannersBtn?.addEventListener('click', async () => {
            try {
                const user = auth.currentUser;                if (user) {
                    await db.collection('users').doc(user.uid).update({
                        userBanner: selectedBanner
                    });
                    
                    nameBannersModal.classList.add('hidden');
                    updateSettingsUserInfo();
                    document.getElementById('settings-modal').classList.remove('hidden');
                    
                    showNotification('Banner aplicado com sucesso!', 'info');
                }
            } catch (error) {
                console.error('Erro ao salvar banner:', error);
                showNotification('Erro ao aplicar banner.', 'error');
            }
        });
        
        // Cancelar
        cancelBannersBtn?.addEventListener('click', () => {
            nameBannersModal.classList.add('hidden');
            updateSettingsUserInfo();
            document.getElementById('settings-modal').classList.remove('hidden');
        });
        
        // Fechar clicando fora
        nameBannersModal?.addEventListener('click', (e) => {
            if (e.target === nameBannersModal) {
                nameBannersModal.classList.add('hidden');
                updateSettingsUserInfo();
                document.getElementById('settings-modal').classList.remove('hidden');
            }
        });
        
        // Função para atualizar preview
        function updateBannerPreview(banner) {
            // Remover todas as classes de banner
            bannerPreviewBg.className = 'absolute inset-0 rounded-lg';
            
            // Adicionar nova classe de banner
            if (banner !== 'none') {
                bannerPreviewBg.classList.add(`name-banner-${banner}`);
            }
        }
          // Função para carregar banner atual do usuário - VERSÃO CORRIGIDA V8
        async function loadUserCurrentBanner() {
            try {
                if (!currentUser) {
                    console.log('❌ Usuário não logado');
                    return;
                }
                
                console.log('🎨 Carregando banner atual do usuário...');
                
                // Usar sintaxe v8 do Firebase
                const userDocRef = db.collection('users').doc(currentUser.uid);
                const userDoc = await userDocRef.get();
                
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    const currentBanner = userData.nameBanner || 'none';
                    
                    console.log('✅ Banner atual carregado:', currentBanner);
                    
                    // Limpar seleções anteriores
                    document.querySelectorAll('.banner-radio').forEach(radio => {
                        radio.classList.remove('selected');
                    });
                    
                    // Marcar o banner atual como selecionado
                    const currentRadio = document.querySelector(`input[name="nameBanner"][value="${currentBanner}"]`);
                    if (currentRadio) {
                        currentRadio.checked = true;
                        currentRadio.closest('.banner-radio').classList.add('selected');
                    }
                    
                } else {
                    console.log('⚠️ Documento do usuário não encontrado');
                }
                
            } catch (error) {
                console.error('❌ Erro ao carregar banner atual:', error);
            }        }
    }

    // Função para salvar efeito de nome - VERSÃO CORRIGIDA V8
    async function saveNameEffect(effect) {
        try {
            if (!currentUser) {
                console.log('❌ Usuário não logado');
                return;
            }
            
            console.log('💾 Salvando efeito de nome:', effect);
            
            // Usar sintaxe v8 do Firebase
            const userDocRef = db.collection('users').doc(currentUser.uid);
            await userDocRef.update({
                nameEffect: effect,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            console.log('✅ Efeito salvo com sucesso!');
            showNotification('Efeito de nome salvo!', 'success');
            
        } catch (error) {
            console.error('❌ Erro ao salvar efeito:', error);
            showNotification('Erro ao salvar efeito', 'error');
        }
    }

    // Função para salvar banner de nome - VERSÃO CORRIGIDA V8
    async function saveNameBanner(banner) {
        try {
            if (!currentUser) {
                console.log('❌ Usuário não logado');
                return;
            }
            
            console.log('💾 Salvando banner de nome:', banner);
            
            // Usar sintaxe v8 do Firebase
            const userDocRef = db.collection('users').doc(currentUser.uid);
            await userDocRef.update({
                nameBanner: banner,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            console.log('✅ Banner salvo com sucesso!');
            showNotification('Banner de nome salvo!', 'success');
            
        } catch (error) {
            console.error('❌ Erro ao salvar banner:', error);
            showNotification('Erro ao salvar banner', 'error');
        }
    }

    // INICIALIZAR APLICAÇÃO
    main();

</script>

<!-- Modal de Perfil -->
<div id="profile-modal" class="hidden modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4">
    <div class="modal-content bg-gray-800 rounded-lg shadow-xl w-full max-w-md border border-gray-700">
        <div class="modal-header flex justify-between items-center p-4">
            <h3 class="text-xl font-bold text-white">Perfil</h3>
            <button id="close-profile-btn" class="text-gray-500 hover:text-gray-300 text-2xl" style="min-height: 44px; min-width: 44px; display: flex; align-items: center; justify-content: center;">&times;</button>
        </div>
        <div class="p-6 space-y-6">
            <div class="flex justify-center">
                <div class="w-32 h-32 rounded-full bg-gray-600 border-4 border-gray-500 overflow-hidden flex items-center justify-center mb-4">
                    <img id="profile-modal-pic" class="w-full h-full object-cover hidden" alt="Perfil">
                    <svg id="profile-modal-icon" class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
            </div>
            <div class="text-center space-y-2">
                <h4 id="profile-modal-name" class="text-white font-semibold text-lg">Nome do Usuário</h4>
                <p id="profile-modal-email" class="text-gray-400">email@exemplo.com</p>
            </div>
            <div class="space-y-3">
                <button id="edit-profile-btn" class="w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300 flex items-center justify-center space-x-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                    <span>Editar Perfil</span>
                </button>
                <button id="change-photo-from-profile-btn" class="w-full py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition duration-300 flex items-center justify-center space-x-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 002-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 002 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <span>Trocar Foto</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Perfil Detalhado -->
<div id="user-profile-detail-modal" class="hidden modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[80] p-4">
    <div class="modal-content bg-gray-900 w-full max-w-md border-0">
        <div class="modal-header flex items-center p-4 bg-gray-800">
            <button id="back-from-profile-detail-btn" class="text-white mr-4 p-2 hover:bg-gray-700 rounded-full transition-colors" style="min-height: 44px; min-width: 44px; display: flex; align-items: center; justify-content: center;">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </button>
            <h3 class="text-xl font-semibold text-white flex-1">Perfil</h3>
        </div>
        <div class="flex-1 overflow-auto bg-gray-900">
            <div class="flex flex-col items-center py-8 bg-gray-800">
                <div class="w-32 h-32 rounded-full bg-gray-600 border-4 border-gray-500 overflow-hidden flex items-center justify-center mb-4">
                    <img id="profile-detail-pic" class="w-full h-full object-cover hidden" alt="Perfil">
                    <svg id="profile-detail-icon" class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
                <button id="edit-photo-btn" class="text-green-400 font-medium hover:text-green-300 transition-colors">Editar foto</button>
            </div>
            <div class="bg-gray-900">
                <div class="profile-detail-section flex items-center justify-between" id="edit-name-section">
                    <div class="flex-1">
                        <div class="profile-detail-label">Nome</div>
                        <div id="profile-detail-name" class="profile-detail-value">Nome do Usuário</div>
                    </div>
                    <svg class="w-5 h-5 profile-detail-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </div>
                <div class="profile-detail-section flex items-center justify-between" id="edit-status-section">
                    <div class="flex-1">
                        <div class="profile-detail-label">Recado</div>
                        <div id="profile-detail-status" class="profile-detail-value">Olá! Eu estou usando o 7Chat.</div>
                    </div>
                    <svg class="w-5 h-5 profile-detail-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </div>
                <div class="profile-detail-section flex items-center justify-between" id="edit-phone-section">
                    <div class="flex-1">
                        <div class="profile-detail-label">Número de telefone</div>
                        <div id="profile-detail-phone" class="profile-detail-value">+55 (11) 99999-9999</div>
                    </div>
                    <svg class="w-5 h-5 profile-detail-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </div>
                <div class="profile-detail-section flex items-center justify-between" id="edit-links-section">
                    <div class="flex-1">
                        <div class="profile-detail-label">Links</div>
                        <div class="text-green-400 font-medium">Adicionar links</div>
                    </div>
                    <svg class="w-5 h-5 profile-detail-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>                </div>            </div>
        </div>    </div>
</div>

<!-- Input oculto para upload de foto -->
<input type="file" id="photo-upload-input" accept="image/*" class="hidden">

<script>
// DEPURAÇÃO 1: Verificar se o modal existe no DOM
console.log('🔍 DEPURAÇÃO - Verificando elementos do modal:');
console.log('Modal exists:', document.getElementById('photo-viewer-modal'));
console.log('Image exists:', document.getElementById('photo-viewer-image'));
console.log('Icon exists:', document.getElementById('photo-viewer-icon'));
console.log('Username exists:', document.getElementById('photo-viewer-username'));
console.log('Close btn exists:', document.getElementById('close-photo-viewer-btn'));

// DEPURAÇÃO 2: Verificar o clique na foto
document.addEventListener('DOMContentLoaded', function() {
    const photoContainer = document.getElementById('settings-photo-container');
    
    if (photoContainer) {
        console.log('✅ Photo container encontrado!');
        
        photoContainer.addEventListener('click', function(e) {
            console.log('🖱️ CLIQUE DETECTADO na foto!');
            console.log('Event:', e);
            
            // Verificar se a função openPhotoViewer existe
            if (typeof openPhotoViewer === 'function') {
                console.log('✅ Função openPhotoViewer existe');
                openPhotoViewer();
            } else {
                console.log('❌ Função openPhotoViewer NÃO existe');
            }
        });
    } else {
        console.log('❌ Photo container NÃO encontrado!');
    }
});

// DEPURAÇÃO 3: Modificar a função openPhotoViewer para mais logs
function openPhotoViewer() {
    console.log('🔍 === INÍCIO openPhotoViewer ===');
    
    const photoViewerModal = document.getElementById('photo-viewer-modal');
    console.log('Modal element:', photoViewerModal);
    
    if (!photoViewerModal) {
        console.log('❌ ERRO: Modal não encontrado!');
        return;
    }
    
    // Verificar classes atuais
    console.log('Classes atuais do modal:', photoViewerModal.className);
    
    // Tentar diferentes métodos para mostrar
    console.log('🔄 Tentando remover classe hidden...');
    photoViewerModal.classList.remove('hidden');
    
    console.log('🔄 Tentando adicionar classe show...');
    photoViewerModal.classList.add('show');
    
    console.log('🔄 Tentando style.display...');
    photoViewerModal.style.display = 'flex';
    
    console.log('🔄 Tentando z-index...');
    photoViewerModal.style.zIndex = '99999';
    
    console.log('Classes após modificação:', photoViewerModal.className);
    console.log('Style display:', photoViewerModal.style.display);
    console.log('Style z-index:', photoViewerModal.style.zIndex);
    
    // Verificar se está visível
    const computedStyle = window.getComputedStyle(photoViewerModal);
    console.log('Computed display:', computedStyle.display);
    console.log('Computed visibility:', computedStyle.visibility);
    console.log('Computed z-index:', computedStyle.zIndex);
    
    console.log('🔍 === FIM openPhotoViewer ===');
}

// DEPURAÇÃO 4: Verificar se há conflitos de CSS
function checkCSSConflicts() {
    const modal = document.getElementById('photo-viewer-modal');
    if (modal) {
        const styles = window.getComputedStyle(modal);
        console.log('🎨 CSS COMPUTED STYLES:');
        console.log('Display:', styles.display);
        console.log('Position:', styles.position);
        console.log('Z-index:', styles.zIndex);
        console.log('Top:', styles.top);
        console.log('Left:', styles.left);
        console.log('Width:', styles.width);
        console.log('Height:', styles.height);
        console.log('Background:', styles.backgroundColor);
        console.log('Opacity:', styles.opacity);
    }
}

// DEPURAÇÃO 5: Listar todos os elementos com z-index alto
function checkZIndexConflicts() {
    const allElements = document.querySelectorAll('*');
    const highZIndex = [];
    
    allElements.forEach(el => {
        const zIndex = window.getComputedStyle(el).zIndex;
        if (zIndex !== 'auto' && parseInt(zIndex) > 1000) {
            highZIndex.push({
                element: el,
                zIndex: zIndex,
                id: el.id || 'sem-id',
                classes: el.className
            });
        }
    });
    
    console.log('🔍 ELEMENTOS COM Z-INDEX ALTO:', highZIndex);
}

// Execute essas funções para testar
setTimeout(() => {
    checkCSSConflicts();
    checkZIndexConflicts();
}, 2000);

// Funcionalidade do Modal de Visualização da Foto
document.addEventListener('DOMContentLoaded', function() {
    const photoViewerModal = document.getElementById('photo-viewer-modal');
    const photoViewerImage = document.getElementById('photo-viewer-image');
    const photoViewerIcon = document.getElementById('photo-viewer-icon');
    const photoViewerUsername = document.getElementById('photo-viewer-username');
    const closePhotoViewerBtn = document.getElementById('close-photo-viewer-btn');
      // Função para abrir o modal de visualização da foto
    function openPhotoViewer() {
        console.log('🔍 openPhotoViewer() chamada');
        
        // Pegar a foto atual do usuário
        const settingsUserPic = document.getElementById('settings-user-pic');
        const settingsUserIcon = document.getElementById('settings-user-icon');
        const settingsUserName = document.getElementById('settings-user-name');
        
        console.log('📸 settingsUserPic:', settingsUserPic);
        console.log('👤 settingsUserIcon:', settingsUserIcon);
        console.log('📝 settingsUserName:', settingsUserName);
          // Atualizar o nome no modal
        if (photoViewerUsername && settingsUserName) {
            photoViewerUsername.textContent = settingsUserName.textContent || 'Usuário';
        }
          // Verificar se tem foto personalizada ou usar ícone padrão
        if (settingsUserPic && !settingsUserPic.classList.contains('hidden')) {
            console.log('✅ Usando foto personalizada');
            // Tem foto personalizada
            if (photoViewerImage) {
                photoViewerImage.src = settingsUserPic.src;
                photoViewerImage.classList.remove('hidden');
            }
            if (photoViewerIcon) {
                photoViewerIcon.classList.add('hidden');
            }
        } else {
            console.log('🔄 Usando ícone padrão');
            // Usar ícone padrão
            if (photoViewerImage) {
                photoViewerImage.classList.add('hidden');
            }
            if (photoViewerIcon) {
                photoViewerIcon.classList.remove('hidden');
            }
        }
        
        console.log('🎯 Mostrando modal de foto');
        // Mostrar modal
        photoViewerModal.classList.remove('hidden');
        
        // Prevenir scroll do body
        document.body.style.overflow = 'hidden';
    }
      // Função para fechar o modal
    function closePhotoViewer() {
        console.log('❌ closePhotoViewer() chamada');
        photoViewerModal.classList.add('hidden');
        document.body.style.overflow = 'auto';    }
      // Event listener para abrir o modal quando clicar na foto das configurações
    const settingsUserPhotoContainer = document.getElementById('settings-photo-container');
    console.log('🎯 settingsUserPhotoContainer encontrado:', settingsUserPhotoContainer);

    if (settingsUserPhotoContainer) {
        settingsUserPhotoContainer.addEventListener('click', function(e) {
            console.log('🔥 CLIQUE na foto das configurações detectado!', e);
            e.stopPropagation(); // Impedir propagação do evento
            e.preventDefault(); // Impedir comportamento padrão
            openPhotoViewer();
        });
        console.log('✅ Event listener da foto adicionado');
    } else {
        console.log('❌ ERRO: settingsUserPhotoContainer não encontrado!');
    }
    
    // Event listeners para fechar o modal
    if (closePhotoViewerBtn) {
        closePhotoViewerBtn.addEventListener('click', closePhotoViewer);
    }
    
    // Fechar modal clicando fora da foto
    if (photoViewerModal) {
        photoViewerModal.addEventListener('click', function(e) {
            if (e.target === photoViewerModal) {
                closePhotoViewer();
            }
        });
    }
    
    // Fechar modal com tecla ESC
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && photoViewerModal && !photoViewerModal.classList.contains('hidden')) {
            closePhotoViewer();
        }
    });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const settingsPhotoContainer = document.getElementById('settings-photo-container');
    const settingsUserPic = document.getElementById('settings-user-pic');
    const photoViewerModal = document.getElementById('photo-viewer-modal');
    const photoViewerImg = photoViewerModal.querySelector('img');
    const closePhotoViewerBtn = document.getElementById('close-photo-viewer-btn');

    // Abre o modal ao clicar na foto do perfil nas configurações
    settingsPhotoContainer.addEventListener('click', function () {
        photoViewerModal.classList.add('show');
        if (settingsUserPic && settingsUserPic.src) {
            photoViewerImg.src = settingsUserPic.src;
            photoViewerImg.alt = settingsUserPic.alt || "Perfil";
        }
    });

    // Fecha o modal ao clicar no "X"
    closePhotoViewerBtn.addEventListener('click', function () {
        photoViewerModal.classList.remove('show');
    });
});
</script>

<script>
// Gerenciamento de notificações
let friendRequests = [];

// SISTEMA REAL DE NOTIFICAÇÕES DO FIREBASE - SUBSTITUA TODO O BLOCO ANTERIOR
friendRequests = [];

// Função para carregar notificações do Firebase - VERSÃO REAL
async function loadNotifications() {
    try {
        if (!currentUser) {
            console.log('❌ Usuário não logado para carregar notificações');
            return;
        }
        
        console.log('🔔 Carregando notificações reais do Firebase...');
        
        // Buscar solicitações de amizade recebidas
        const friendRequestsRef = db.collection('friend_requests');
        const friendRequestsQuery = friendRequestsRef
            .where('to', '==', currentUser.uid)
            .where('status', '==', 'pending');
        
        const friendRequestsSnapshot = await friendRequestsQuery.get();
        
        console.log(`📨 Solicitações encontradas: ${friendRequestsSnapshot.size}`);
        
        // Limpar array de solicitações
        friendRequests = [];
        
        // Adicionar solicitações encontradas
        friendRequestsSnapshot.forEach((doc) => {
            const requestData = doc.data();
            friendRequests.push({
                id: doc.id,
                name: requestData.fromName || 'Usuário',
                avatar: requestData.fromPhoto || null,
                fromId: requestData.from,
                createdAt: requestData.createdAt
            });
            
            console.log('✅ Solicitação adicionada:', {
                id: doc.id,
                from: requestData.fromName,
                to: requestData.toName
            });
        });
        
        // Atualizar badge e renderizar
        updateNotificationsBadge();
        renderFriendRequests();
        
        console.log(`🔔 ${friendRequests.length} notificações carregadas`);
        
    } catch (error) {
        console.error('❌ Erro ao carregar notificações:', error);
    }
}

// Função para configurar listener em tempo real para notificações
function setupNotificationsListener() {
    if (!currentUser) return;
    
    console.log('👂 Configurando listener de notificações em tempo real...');
    
    // Listener para solicitações de amizade
    const friendRequestsRef = db.collection('friend_requests');
    const friendRequestsQuery = friendRequestsRef
        .where('to', '==', currentUser.uid)
        .where('status', '==', 'pending');
    
    // Escutar mudanças em tempo real
    const unsubscribe = friendRequestsQuery.onSnapshot((snapshot) => {
        console.log('🔄 Mudança detectada nas solicitações de amizade');
        
        // Limpar solicitações atuais
        friendRequests = [];
        
        // Adicionar novas solicitações
        snapshot.forEach((doc) => {
            const requestData = doc.data();
            friendRequests.push({
                id: doc.id,
                name: requestData.fromName || 'Usuário',
                avatar: requestData.fromPhoto || null,
                fromId: requestData.from,
                createdAt: requestData.createdAt
            });
        });
        
        // Atualizar interface
        updateNotificationsBadge();
        renderFriendRequests();
        
        // Mostrar notificação se houver novas solicitações
        if (friendRequests.length > 0) {
            showNotification(`Você tem ${friendRequests.length} solicitação(ões) de amizade`, 'info');
        }
        
        console.log(`🔔 Listener atualizado: ${friendRequests.length} solicitações`);
    }, (error) => {
        console.error('❌ Erro no listener de notificações:', error);
    });
    
    // Salvar referência para poder cancelar depois
    window.notificationsUnsubscribe = unsubscribe;
}

// Função para aceitar solicitação de amizade - VERSÃO REAL
// Função para aceitar solicitação de amizade - VERSÃO CORRIGIDA
async function acceptFriendRequest(requestId) {
    try {
        console.log('✅ Aceitando solicitação:', requestId);
        
        // Buscar dados da solicitação
        const requestRef = db.collection('friend_requests').doc(requestId);
        const requestDoc = await requestRef.get();
        
        if (!requestDoc.exists) {
            console.error('❌ Solicitação não encontrada');
            showNotification('Solicitação não encontrada', 'error');
            return;
        }
        
        const requestData = requestDoc.data();
        console.log('📋 Dados da solicitação:', requestData);
        
        // Usar transação para garantir consistência - VERSÃO CORRIGIDA
        await db.runTransaction(async (transaction) => {
            // 1. PRIMEIRO: Fazer todas as LEITURAS
            const currentUserRef = db.collection('users').doc(currentUser.uid);
            const friendUserRef = db.collection('users').doc(requestData.from);
            
            const currentUserDoc = await transaction.get(currentUserRef);
            const friendUserDoc = await transaction.get(friendUserRef);
            
            // 2. DEPOIS: Fazer todas as ESCRITAS
            // Atualizar status da solicitação
            transaction.update(requestRef, {
                status: 'accepted',
                acceptedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            // Adicionar como amigos mútuos
            const currentUserData = currentUserDoc.data() || {};
            const friendUserData = friendUserDoc.data() || {};
            
            const currentUserFriends = currentUserData.friends || [];
            const friendUserFriends = friendUserData.friends || [];
            
            // Adicionar IDs nas listas de amigos (se não existir)
            if (!currentUserFriends.includes(requestData.from)) {
                transaction.update(currentUserRef, {
                    friends: firebase.firestore.FieldValue.arrayUnion(requestData.from)
                });
            }
            
            if (!friendUserFriends.includes(currentUser.uid)) {
                transaction.update(friendUserRef, {
                    friends: firebase.firestore.FieldValue.arrayUnion(currentUser.uid)
                });
            }
        });
        
        // Atualização imediata na interface local
        friendRequests = friendRequests.filter(req => req.id !== requestId);
        updateNotificationsBadge();
        renderFriendRequests();
          // IMPORTANTE: Recarregar lista de amigos
        console.log('🔄 Recarregando lista de amigos...');
        await loadFriendsList();
        
        // Integrar com sistema de conversas
        try {
            initializeConversationForFriend(requestData.fromName, requestData.fromAvatar);
        } catch (convError) {
            console.log('Erro ao inicializar conversa:', convError);
        }
        
        showNotification(`${requestData.fromName} agora é seu amigo!`, 'success');
        console.log('✅ Solicitação aceita e amizade criada com sucesso');
        
    } catch (error) {
        console.error('❌ Erro ao aceitar solicitação:', error);
        showNotification('Erro ao aceitar solicitação: ' + error.message, 'error');
    }
}

// Função para rejeitar solicitação de amizade
async function rejectFriendRequest(requestId) {
    try {
        console.log('❌ Rejeitando solicitação:', requestId);
        
        // Buscar dados da solicitação
        const requestRef = db.collection('friend_requests').doc(requestId);
        const requestDoc = await requestRef.get();
        
        if (!requestDoc.exists) {
            console.error('❌ Solicitação não encontrada');
            showNotification('Solicitação não encontrada', 'error');
            return;
        }
        
        const requestData = requestDoc.data();
        
        // Atualizar status da solicitação para rejeitada
        await requestRef.update({
            status: 'rejected',
            rejectedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        // Atualização imediata na interface local
        friendRequests = friendRequests.filter(req => req.id !== requestId);
        updateNotificationsBadge();
        renderFriendRequests();
        
        showNotification(`Solicitação de ${requestData.fromName} foi rejeitada`, 'info');
        console.log('✅ Solicitação rejeitada com sucesso');
        
    } catch (error) {
        console.error('❌ Erro ao rejeitar solicitação:', error);
        showNotification('Erro ao rejeitar solicitação: ' + error.message, 'error');
    }
}

function updateNotificationsBadge() {
    const badge = document.getElementById('notifications-badge');
    const count = friendRequests.length;
    
    if (count > 0) {
        badge.textContent = count > 99 ? '99+' : count;
        badge.classList.remove('hidden');
    } else {
        badge.classList.add('hidden');
    }
}

function renderFriendRequests() {
    const container = document.getElementById('friend-requests-list');
    if (!container) return;
    
    console.log('🎨 Renderizando solicitações de amizade:', friendRequests.length);
    
    if (friendRequests.length === 0) {
        container.innerHTML = `
            <div class="text-center text-gray-400 py-12">
                <i class="fas fa-bell-slash text-6xl text-gray-600 mb-4"></i>
                <p class="text-lg mb-2">Nenhuma notificação</p>
                <p class="text-sm">Você não tem solicitações de amizade pendentes</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = friendRequests.map(request => `
        <div class="friend-request-item bg-gray-700 rounded-lg p-4 mb-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 rounded-full bg-gray-600 overflow-hidden">
                        ${request.avatar ? 
                            `<img src="${request.avatar}" alt="${request.name}" class="w-full h-full object-cover">` :
                            `<div class="w-full h-full flex items-center justify-center text-gray-400 font-bold text-lg">${request.name.charAt(0).toUpperCase()}</div>`
                        }
                    </div>
                    <div>
                        <h4 class="text-white font-medium">${request.name}</h4>
                        <p class="text-gray-400 text-sm">Quer ser seu amigo</p>
                        ${request.createdAt ? `<p class="text-xs text-gray-500">${formatDate(request.createdAt)}</p>` : ''}
                    </div>
                </div>
                <div class="flex space-x-2">
                    <button 
                        onclick="acceptFriendRequest('${request.id}')"
                        class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-lg text-sm font-medium transition-colors">
                        Aceitar
                    </button>
                    <button 
                        onclick="rejectFriendRequest('${request.id}')"
                        class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-lg text-sm font-medium transition-colors">
                        Rejeitar
                    </button>
                </div>
            </div>
        </div>
    `).join('');
}

// Função auxiliar para formatar data
function formatDate(timestamp) {
    if (!timestamp) return 'Agora';
    
    try {
        const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
        const now = new Date();
        const diffMinutes = Math.floor((now - date) / (1000 * 60));
        
        if (diffMinutes < 1) return 'Agora';
        if (diffMinutes < 60) return `${diffMinutes}m atrás`;
        if (diffMinutes < 1440) return `${Math.floor(diffMinutes / 60)}h atrás`;
        return date.toLocaleDateString();
    } catch (error) {
        return 'Recente';
    }
}

// Event listeners para notificações
document.getElementById('notifications-btn').addEventListener('click', function() {
    document.getElementById('notifications-modal').classList.remove('hidden');
    renderFriendRequests();
});

document.getElementById('close-notifications-btn').addEventListener('click', function() {
    document.getElementById('notifications-modal').classList.add('hidden');
});

// Inicializar sistema de notificações
updateNotificationsBadge();

// Função para carregar lista de amigos do Firebase
async function loadFriendsList() {
    try {
        if (!currentUser) {
            console.log('❌ Usuário não logado para carregar amigos');
            return;
        }
        
        console.log('👥 Carregando lista de amigos...');
        
        // Buscar dados do usuário atual
        const currentUserRef = db.collection('users').doc(currentUser.uid);
        const currentUserDoc = await currentUserRef.get();
        
        if (!currentUserDoc.exists) {
            console.log('❌ Documento do usuário não encontrado');
            return;
        }
        
        const userData = currentUserDoc.data();
        const friendIds = userData.friends || [];
        
        console.log('📋 IDs dos amigos:', friendIds);
        
        if (friendIds.length === 0) {
            renderFriendsTab('all', []);
            renderFriendsTab('online', []);
            return;
        }
        
        // Buscar dados dos amigos
        const friendsData = [];
        
        // Processar em lotes para evitar problemas com muitos amigos
        const batchSize = 10;
        for (let i = 0; i < friendIds.length; i += batchSize) {
            const batchIds = friendIds.slice(i, i + batchSize);
            
            const friendsQuery = db.collection('users').where(firebase.firestore.FieldPath.documentId(), 'in', batchIds);
            const friendsSnapshot = await friendsQuery.get();
            
            friendsSnapshot.forEach((doc) => {
                const friendData = doc.data();
                friendsData.push({
                    id: doc.id,
                    name: friendData.username || friendData.displayName || friendData.email || 'Usuário',
                    avatar: friendData.photoURL || null,
                    status: getUserStatus(friendData.lastSeen),
                    lastSeen: friendData.lastSeen,
                    userStatus: friendData.status || 'Usando 7Chat'
                });
            });
        }
        
        console.log(`✅ ${friendsData.length} amigos carregados`);
        
        // Separar amigos online e offline
        const onlineFriends = friendsData.filter(friend => friend.status === 'online');
        
        // Renderizar nas abas
        renderFriendsTab('all', friendsData);
        renderFriendsTab('online', onlineFriends);
        
    } catch (error) {
        console.error('❌ Erro ao carregar lista de amigos:', error);
    }
}

// Função para renderizar amigos na aba específica
function renderFriendsTab(tabName, friends) {
    const containerId = `content-${tabName}`;
    const container = document.getElementById(containerId);
    
    if (!container) {
        console.log(`❌ Container ${containerId} não encontrado`);
        return;
    }
    
    if (friends.length === 0) {
        const emptyMessages = {
            'all': {
                icon: 'fas fa-user-friends',
                title: 'Você ainda não tem amigos',
                subtitle: 'Use a busca para encontrar e adicionar amigos'
            },
            'online': {
                icon: 'fas fa-users',
                title: 'Nenhum amigo online',
                subtitle: 'Seus amigos aparecerão aqui quando estiverem online'
            }
        };
        
        const message = emptyMessages[tabName];
        container.innerHTML = `
            <div class="text-center text-gray-400 py-12">
                <i class="${message.icon} text-6xl text-gray-600 mb-4"></i>
                <p class="text-lg mb-2">${message.title}</p>
                <p class="text-sm">${message.subtitle}</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = `
        <div class="space-y-3">
            ${friends.map(friend => `
                <div class="bg-gray-700 rounded-lg p-4 flex items-center justify-between hover:bg-gray-600 transition-colors">
                    <div class="flex items-center space-x-3">
                        <div class="relative">
                            <div class="w-12 h-12 rounded-full overflow-hidden bg-gray-600">
                                ${friend.avatar ? 
                                    `<img src="${friend.avatar}" alt="${friend.name}" class="w-full h-full object-cover">` :
                                    `<div class="w-full h-full flex items-center justify-center text-gray-400 font-bold text-lg">${friend.name.charAt(0).toUpperCase()}</div>`
                                }
                            </div>
                            <div class="absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-gray-700 user-status-${friend.status}"></div>
                        </div>
                        <div>
                            <h4 class="text-white font-medium">${friend.name}</h4>
                            <p class="text-gray-400 text-sm">${friend.userStatus}</p>
                            <p class="text-xs text-gray-500">${getStatusText(friend.status, friend.lastSeen)}</p>
                        </div>
                    </div>                    <button onclick="startChat('${friend.name}', '${friend.avatar || ''}', '${friend.status}')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                        Conversar
                    </button>
                </div>
            `).join('')}
        </div>
    `;
}

// Função auxiliar para texto de status
function getStatusText(status, lastSeen) {
    const statusTexts = {
        'online': 'Online',
        'away': 'Ausente',
        'offline': getOfflineText(lastSeen)
    };
    return statusTexts[status] || 'Offline';
}

function getOfflineText(lastSeen) {
    if (!lastSeen) return 'Offline';
    
    try {
        const date = lastSeen.toDate ? lastSeen.toDate() : new Date(lastSeen);
        const now = new Date();
        const diffMinutes = Math.floor((now - date) / (1000 * 60));
        
        if (diffMinutes < 60) return `Visto há ${diffMinutes}m`;
        if (diffMinutes < 1440) return `Visto há ${Math.floor(diffMinutes / 60)}h`;
        return `Visto há ${Math.floor(diffMinutes / 1440)}d`;
    } catch (error) {
        return 'Offline';
    }
}

// Função para configurar listeners de amigos em tempo real
function setupFriendsListener() {
    if (!currentUser) return;
    
    console.log('👂 Configurando listener de amigos em tempo real...');
    
    // Listener para mudanças no documento do usuário (lista de amigos)
    const currentUserRef = db.collection('users').doc(currentUser.uid);
    
    const unsubscribeFriends = currentUserRef.onSnapshot((doc) => {
        if (doc.exists) {
            console.log('🔄 Lista de amigos atualizada em tempo real');
            loadFriendsList();
        }
    }, (error) => {
        console.error('❌ Erro no listener de amigos:', error);
    });
    
    // Salvar referência para poder cancelar depois
    window.friendsUnsubscribe = unsubscribeFriends;
}
</script>

<script>
// Remover dados simulados e usar dados reais do Firebase
// Variáveis globais para busca e controle das abas
let searchTimeout = null;
let currentTab = 'online';

// Função para buscar usuários reais no Firestore - VERSÃO CORRIGIDA
async function searchUsers(query) {
    console.log('🔍 [SEARCH DEBUG] Iniciando busca por:', query);
    
    if (!query.trim()) {
        document.getElementById('search-initial-state').classList.remove('hidden');
        document.getElementById('search-no-results').classList.add('hidden'); 
        document.getElementById('search-results').innerHTML = '';
        return;
    }
    
    document.getElementById('search-initial-state').classList.add('hidden');
    document.getElementById('search-loading').classList.remove('hidden');
    
    try {
        console.log('🔍 [SEARCH DEBUG] Obtendo todos os usuários do Firestore...');
        
        // Obter TODOS os usuários do Firestore (sintaxe v8)
        const usersRef = db.collection('users');
        const snapshot = await usersRef.get();
        
        console.log(`🔍 [SEARCH DEBUG] Documentos encontrados: ${snapshot.size}`);
        
        if (snapshot.empty) {
            console.log('⚠️ [SEARCH DEBUG] Nenhum documento encontrado na coleção users');
            document.getElementById('search-loading').classList.add('hidden');
            document.getElementById('search-no-results').classList.remove('hidden');
            document.getElementById('search-results').innerHTML = '';
            return;
        }
        
        const foundUsers = [];
        const searchTerm = query.toLowerCase();
        
        snapshot.forEach((doc) => {
            const userData = doc.data();
            const userId = doc.id;
            
            console.log(`🔍 [SEARCH DEBUG] Analisando usuário ${userId}:`, {
                email: userData.email,
                displayName: userData.displayName,
                photoURL: userData.photoURL,
                status: userData.status,
                lastSeen: userData.lastSeen
            });
            
            // Não mostrar o próprio usuário
            if (userId === currentUser?.uid) {
                console.log(`🔍 [SEARCH DEBUG] Ignorando usuário atual: ${userId}`);
                return;
            }
            
            // Buscar nos campos: displayName, email, username
            const displayName = (userData.displayName || '').toLowerCase();
            const email = (userData.email || '').toLowerCase();
            const username = (userData.username || '').toLowerCase();
            
            const matches = 
                displayName.includes(searchTerm) ||
                email.includes(searchTerm) ||
                username.includes(searchTerm);
            
            if (matches) {
                console.log(`✅ [SEARCH DEBUG] Match encontrado para ${userId}`);
                
                foundUsers.push({
                    id: userId,
                    name: userData.displayName || userData.email || 'Usuário',
                    username: userData.email || userData.username || 'sem-email',
                    status: userData.status || 'offline',
                    avatar: userData.photoURL || `https://placehold.co/48x48/4f46e5/ffffff?text=${(userData.displayName || userData.email || 'U').charAt(0).toUpperCase()}`,
                    lastSeen: userData.lastSeen || new Date()
                });
            } else {
                console.log(`❌ [SEARCH DEBUG] Sem match para ${userId} - displayName: "${displayName}", email: "${email}", username: "${username}" vs "${searchTerm}"`);
            }
        });
        
        console.log(`🔍 [SEARCH DEBUG] Total de usuários encontrados: ${foundUsers.length}`);
        
        document.getElementById('search-loading').classList.add('hidden');
        
        if (foundUsers.length === 0) {
            console.log('⚠️ [SEARCH DEBUG] Nenhum usuário corresponde à busca');
            document.getElementById('search-no-results').classList.remove('hidden');
            document.getElementById('search-results').innerHTML = '';
        } else {
            console.log('✅ [SEARCH DEBUG] Renderizando resultados');
            document.getElementById('search-no-results').classList.add('hidden');
            renderSearchResults(foundUsers);
        }
        
    } catch (error) {
        console.error('❌ [SEARCH DEBUG] Erro ao buscar usuários:', error);
        document.getElementById('search-loading').classList.add('hidden');
        document.getElementById('search-no-results').classList.remove('hidden');
        document.getElementById('search-results').innerHTML = '';
    }
}

// Função para testar conexão com Firebase e debug dos dados
async function testFirebaseConnection() {
    console.log('🔥 [FIREBASE TEST] Testando conexão com Firebase...');
    
    try {
        // Verificar se o Firebase está inicializado
        if (!firebase || !db) {
            console.error('❌ [FIREBASE TEST] Firebase não está inicializado');
            return false;
        }
        
        console.log('✅ [FIREBASE TEST] Firebase inicializado com sucesso');
        
        // Testar acesso à coleção users
        console.log('🔥 [FIREBASE TEST] Testando acesso à coleção users...');
        const usersRef = db.collection('users');
        const snapshot = await usersRef.limit(5).get();
        
        console.log(`🔥 [FIREBASE TEST] Documentos na coleção users: ${snapshot.size}`);
        
        if (!snapshot.empty) {
            console.log('🔥 [FIREBASE TEST] Estrutura dos primeiros usuários:');
            snapshot.forEach((doc, index) => {
                const data = doc.data();
                console.log(`Usuario ${index + 1} (${doc.id}):`, {
                    email: data.email,
                    displayName: data.displayName,
                    photoURL: data.photoURL,
                    status: data.status,
                    lastSeen: data.lastSeen,
                    friends: data.friends ? Object.keys(data.friends) : [],
                    friendRequests: data.friendRequests ? Object.keys(data.friendRequests) : [],
                    effects: data.effects
                });
            });
        } else {
            console.log('⚠️ [FIREBASE TEST] Coleção users está vazia');
        }
        
        // Verificar usuário atual
        if (currentUser) {
            console.log('🔥 [FIREBASE TEST] Testando dados do usuário atual...');
            const userDoc = await db.collection('users').doc(currentUser.uid).get();
            
            if (userDoc.exists) {
                console.log('✅ [FIREBASE TEST] Dados do usuário atual:', userDoc.data());
            } else {
                console.log('⚠️ [FIREBASE TEST] Documento do usuário atual não existe');
            }
        } else {
            console.log('⚠️ [FIREBASE TEST] Nenhum usuário logado');
        }
        
        return true;
        
    } catch (error) {
        console.error('❌ [FIREBASE TEST] Erro ao testar Firebase:', error);
        return false;
    }
}

// Função para determinar status do usuário baseado em lastSeen
function getUserStatus(lastSeen) {
    if (!lastSeen) return 'offline';
    
    const now = new Date();
    const lastSeenDate = lastSeen.toDate ? lastSeen.toDate() : new Date(lastSeen);
    const diffMinutes = Math.floor((now - lastSeenDate) / (1000 * 60));
    
    if (diffMinutes < 5) return 'online';
    if (diffMinutes < 30) return 'away';
    return 'offline';
}

// Função para renderizar resultados com usuários reais
function renderSearchResults(users) {
    const container = document.getElementById('search-results');
    
    container.innerHTML = users.map(user => {
        const status = getUserStatus(user.lastSeen);
        const statusText = {
            'online': 'Online',
            'away': 'Ausente',
            'offline': 'Offline'
        };
        
        return `
            <div class="search-result-item">
                <div class="flex items-center space-x-3">
                    <div class="relative">
                        <div class="w-12 h-12 rounded-full overflow-hidden">
                            <img src="${user.avatar}" alt="${user.name}" class="w-full h-full object-cover" onerror="this.src='https://placehold.co/48x48/6b7280/ffffff?text=${user.name.charAt(0).toUpperCase()}'">
                        </div>
                        <div class="absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-gray-800 user-status-${status}"></div>
                    </div>
                    <div>
                        <h4 class="text-white font-medium">${user.name}</h4>
                        <p class="text-gray-400 text-sm">${user.username}</p>
                        <p class="text-xs text-gray-500">${statusText[status]}</p>
                    </div>
                </div>
                <button class="add-friend-btn bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors" data-user-id="${user.id}" data-user-name="${user.name}">
                    Adicionar
                </button>
            </div>
        `;
    }).join('');
}

// Função para enviar solicitação de amizade - VERSÃO CORRIGIDA
async function sendFriendRequest(targetUserId, targetUserName) {
    try {
        console.log('📤 Enviando solicitação de amizade para:', targetUserName);
        
        // Criar solicitação no Firestore
        const friendRequestData = {
            from: currentUser.uid,
            fromName: currentUser.displayName || currentUser.email,
            fromPhoto: currentUser.photoURL || null,
            to: targetUserId,
            toName: targetUserName,
            status: 'pending',
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            type: 'friend_request'
        };
        
        // Salvar na coleção de friend_requests
        await db.collection('friend_requests').add(friendRequestData);
        
        // Adicionar notificação para o usuário alvo
        await db.collection('notifications').add({
            userId: targetUserId,
            type: 'friend_request',
            title: 'Nova solicitação de amizade',
            message: `${friendRequestData.fromName} quer ser seu amigo`,
            data: friendRequestData,
            read: false,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        console.log('✅ Solicitação enviada com sucesso!');
        showNotification(`Solicitação enviada para ${targetUserName}!`, 'success');
        
    } catch (error) {
        console.error('❌ Erro ao enviar solicitação:', error);
        showNotification('Erro ao enviar solicitação', 'error');
    }
}

// Função para trocar abas na tela de amigos
function switchTab(tabName) {
    console.log('🔄 Trocando para aba:', tabName);
    
    // Remover classe ativa de todas as abas
    document.querySelectorAll('[id^="tab-"]').forEach(tab => {
        tab.classList.remove('text-blue-400', 'border-b-2', 'border-blue-500', 'bg-gray-700');
        tab.classList.add('text-gray-400');
    });
    
    // Adicionar classe ativa à aba selecionada
    const activeTab = document.getElementById(`tab-${tabName}`);
    if (activeTab) {
        activeTab.classList.remove('text-gray-400');
        activeTab.classList.add('text-blue-400', 'border-b-2', 'border-blue-500', 'bg-gray-700');
    }
    
    // Esconder todo o conteúdo
    document.querySelectorAll('[id^="content-"]').forEach(content => {
        content.classList.add('hidden');
    });
    
    // Mostrar conteúdo da aba ativa
    const activeContent = document.getElementById(`content-${tabName}`);
    if (activeContent) {
        activeContent.classList.remove('hidden');
    }
    
    currentTab = tabName;
    
    // Carregar dados específicos da aba se necessário
    if (tabName === 'pending') {
        loadPendingRequests();
    }
}

// Função para carregar solicitações pendentes - VERSÃO CORRIGIDA
async function loadPendingRequests() {
    try {
        console.log('📋 Carregando solicitações pendentes...');
        
        if (!currentUser) {
            console.log('❌ Usuário não logado');
            return;
        }
        
        // Usar a sintaxe v8 do Firebase
        const requestsRef = db.collection('friend_requests');
        const q = requestsRef.where('from', '==', currentUser.uid).where('status', '==', 'pending');
        const snapshot = await q.get();
        
        const pendingContainer = document.getElementById('content-pending');
        if (!pendingContainer) {
            console.log('❌ Container não encontrado');
            return;
        }
        
        if (snapshot.empty) {
            pendingContainer.innerHTML = `
                <div class="text-center text-gray-400 py-12">
                    <i class="fas fa-clock text-6xl text-gray-600 mb-4"></i>
                    <p class="text-lg mb-2">Nenhuma solicitação pendente</p>
                    <p class="text-sm">Solicitações de amizade enviadas aparecerão aqui</p>
                </div>
            `;
        } else {
            const requests = [];
            snapshot.forEach(doc => {
                requests.push({ id: doc.id, ...doc.data() });
            });
            
            pendingContainer.innerHTML = `
                <div class="space-y-3">
                    ${requests.map(request => `
                        <div class="bg-gray-700 rounded-lg p-4 flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 rounded-full bg-gray-600 overflow-hidden">
                                    <img src="${request.fromPhoto || 'https://placehold.co/48x48/6b7280/ffffff?text=' + (request.toName || 'U').charAt(0)}" alt="${request.toName || 'Usuário'}" class="w-full h-full object-cover">
                                </div>
                                <div>
                                    <h4 class="text-white font-medium">${request.toName || 'Usuário'}</h4>
                                    <p class="text-gray-400 text-sm">Solicitação enviada</p>
                                    <p class="text-xs text-gray-500">${request.createdAt ? new Date(request.createdAt.toDate()).toLocaleDateString() : 'Hoje'}</p>
                                </div>
                            </div>
                            <span class="text-yellow-400 text-sm font-medium">Pendente</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        console.log('✅ Solicitações carregadas');
        
    } catch (error) {
        console.error('❌ Erro ao carregar solicitações pendentes:', error);
        const pendingContainer = document.getElementById('content-pending');
        if (pendingContainer) {
            pendingContainer.innerHTML = `
                <div class="text-center text-gray-400 py-12">
                    <i class="fas fa-exclamation-triangle text-6xl text-red-500 mb-4"></i>
                    <p class="text-lg mb-2">Erro ao carregar</p>
                    <p class="text-sm text-red-400">${error.message}</p>
                    <button onclick="loadPendingRequests()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
                        Tentar Novamente
                    </button>
                </div>
            `;
        }
    }
}

// Event listeners principais - Sistema de amigos e busca
document.addEventListener('DOMContentLoaded', function() {
    console.log('🚀 Inicializando sistema de amigos e busca...');
    
    // Event listeners para abas
    const tabOnline = document.getElementById('tab-online');
    const tabAll = document.getElementById('tab-all');
    const tabPending = document.getElementById('tab-pending');
    const tabBlocked = document.getElementById('tab-blocked');
    
    if (tabOnline) {
        tabOnline.addEventListener('click', function(e) {
            e.preventDefault();
            switchTab('online');
        });
    }
    
    if (tabAll) {
        tabAll.addEventListener('click', function(e) {
            e.preventDefault();
            switchTab('all');
        });
    }
    
    if (tabPending) {
        tabPending.addEventListener('click', function(e) {
            e.preventDefault();
            switchTab('pending');
        });
    }
    
    if (tabBlocked) {
        tabBlocked.addEventListener('click', function(e) {
            e.preventDefault();
            switchTab('blocked');
        });
    }
    
    // Abrir modal de busca
    const globalSearchBtn = document.getElementById('global-search-btn');
    if (globalSearchBtn) {
        globalSearchBtn.addEventListener('click', function() {
            console.log('🔍 Abrindo modal de busca');
            document.getElementById('global-search-modal').classList.remove('hidden');
            document.getElementById('global-search-input').focus();
        });
    }
    
    // Fechar modal de busca
    const closeSearchBtn = document.getElementById('close-global-search-btn');
    if (closeSearchBtn) {
        closeSearchBtn.addEventListener('click', function() {
            console.log('❌ Fechando modal de busca');
            document.getElementById('global-search-modal').classList.add('hidden');
            document.getElementById('global-search-input').value = '';
            document.getElementById('search-results').innerHTML = '';
            document.getElementById('search-initial-state').classList.remove('hidden');
            document.getElementById('search-no-results').classList.add('hidden');
        });
    }
    
    // Busca com debounce
    const searchInput = document.getElementById('global-search-input');
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                searchUsers(this.value);
            }, 500);
        });
    }
    
    // Adicionar amigo
    const searchResults = document.getElementById('search-results');
    if (searchResults) {
        searchResults.addEventListener('click', async function(e) {
            if (e.target.classList.contains('add-friend-btn')) {
                const userId = e.target.dataset.userId;
                const userName = e.target.dataset.userName;
                
                // Mudar visual do botão
                e.target.textContent = 'Enviando...';
                e.target.disabled = true;
                
                // Enviar solicitação
                await sendFriendRequest(userId, userName);
                
                // Atualizar botão
                e.target.textContent = 'Enviado';
                e.target.classList.remove('bg-blue-600', 'hover:bg-blue-700');                e.target.classList.add('bg-gray-600');
            }
        });
    }
});

// Função para inicializar conversa quando aceita amizade
function initializeConversationForFriend(friendName, friendAvatar = null) {
    if (!conversationManager) {
        console.log('ConversationManager não inicializado');
        return;
    }
    
    // Criar entrada de conversa se não existir
    if (!conversationManager.conversations[friendName]) {
        conversationManager.conversations[friendName] = {
            name: friendName,
            avatar: friendAvatar,
            status: 'online',
            messages: [],
            lastMessage: 'Agora vocês são amigos! Iniciem uma conversa.',
            lastMessageTime: new Date().toISOString(),
            unreadCount: 0
        };
        conversationManager.saveConversations();
        conversationManager.renderConversations();
        console.log(`Conversa inicializada para amigo: ${friendName}`);
    }
}

// Aguardar que tudo carregue antes de inicializar
window.addEventListener('load', function() {
    console.log('Página carregada, aguardando inicialização...');
    setTimeout(() => {
        try {
            conversationManager = new ConversationManager();
            conversationManager.init();
        } catch (error) {
            console.log('Erro na inicialização:', error);
        }
    }, 2000); // Aguardar 2 segundos para garantir que tudo carregou
});
</script>

</body>
</html>
